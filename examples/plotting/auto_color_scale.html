

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Auto Color Scale &mdash; QCoDeS 0.2.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Live Plotting" href="live_plotting.html" />
    <link rel="prev" title="Example Measurements with Real Instruments" href="../DataSet/Real_instruments/Example Measurements with Real Instruments.html" />
    <link href="../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> QCoDeS
          

          
          </a>

          
            
            
              <div class="version">
                0.2.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../help.html">Get Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/index.html">Community Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataset/index.html">DataSet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">QCoDes API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/generated/qcodes.instrument_drivers.html">qcodes.instrument_drivers package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes/index.html">Changelogs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Examples of using QCoDeS</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#basic-examples">Basic examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#dataset">DataSet</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#plotting">Plotting</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Auto Color Scale</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#TL;DR">TL;DR</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Table-of-contents">Table of contents</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Introduction-to-the-problem-and-risks">Introduction to the problem and risks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Using-the-automatic-color-scale">Using the automatic color scale</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Cuttoff-Percentiles">Cuttoff Percentiles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Defaults-and-customizing-the-auto-color-scaling">Defaults and customizing the auto color scaling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Using-auto-color-scaling-in-custom-plotting">Using auto color scaling in custom plotting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="live_plotting.html">Live Plotting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#drivers">Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#writing-drivers">Writing Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#logging">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#legacy-examples">Legacy examples</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">QCoDeS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Examples of using QCoDeS</a> &raquo;</li>
        
      <li>Auto Color Scale</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/examples/plotting/auto_color_scale.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Auto-Color-Scale">
<h1>Auto Color Scale<a class="headerlink" href="#Auto-Color-Scale" title="Permalink to this headline">¶</a></h1>
<p>(back to overview <a class="reference internal" href="../Main.html"><span class="doc">offline</span></a>,<a class="reference external" href="https://nbviewer.jupyter.org/github/QCoDeS/Qcodes/tree/master/docs/examples/Main.ipynb">online</a>)</p>
<p><a class="reference external" href="https://nbviewer.jupyter.org/github/QCoDeS/Qcodes/tree/master/docs/examples/plotting/auto_color_scale.ipynb">read on nbviewer</a></p>
<div class="section" id="TL;DR">
<h2>TL;DR<a class="headerlink" href="#TL;DR" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>use <code class="docutils literal notranslate"><span class="pre">plot_by_id(run_id,</span> <span class="pre">auto_color_scale=True,</span> <span class="pre">cutoff_percentile=(0.5,</span> <span class="pre">0.6)</span></code> to enable automatic color scaling</p></li>
<li><p>this maximally cuts 0.5% of the low valued data points and 0.6% of the high valued data points.</p></li>
<li><p>You can also use it for <code class="docutils literal notranslate"><span class="pre">show_num</span></code> or for matplotlib with the supplied auto scaling function.</p></li>
<li><p>Set your defaults in <code class="docutils literal notranslate"><span class="pre">qcodesrc.json</span></code>.</p></li>
</ul>
</div>
<div class="section" id="Table-of-contents">
<h2>Table of contents<a class="headerlink" href="#Table-of-contents" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p><a class="reference external" href="#Introduction-to-the-problem-and-risks">Introduction to the problem and risks</a></p></li>
<li><p><a class="reference external" href="#using">Using the automatic color scale</a></p>
<ol class="arabic simple">
<li><p><a class="reference external" href="#case1">Example 1: outliers in homogeneous data</a></p></li>
</ol>
</li>
<li><p><a class="reference external" href="#details">Details of the calculation</a></p></li>
<li><p><a class="reference external" href="#percentiles">Cutoff Percentiles</a></p>
<ol class="arabic simple">
<li><p><a class="reference external" href="#case2">Example 2: data on noisy background with outliers</a></p></li>
</ol>
</li>
<li><p><a class="reference external" href="#customizing">Defaults and customizing the auto color scaling</a></p></li>
<li><p><a class="reference external" href="#custom_plotting">Using auto color scaling in custom plotting</a></p></li>
</ol>
</div>
<div class="section" id="Introduction-to-the-problem-and-risks">
<h2>Introduction to the problem and risks<a class="headerlink" href="#Introduction-to-the-problem-and-risks" title="Permalink to this headline">¶</a></h2>
<p>It is a fairly common annoyance that a heat map plot of ones dearest data does not show any of its details due to some outliers that push the range of the color scale beyond the desired limits, as it is shown in the image below: <img alt="image0" src="../../_images/auto_color_scale_swamped_small.png" /> Here there are two pixels (black and white) corresponding to high and low outliers. The remaining data is uniformly displayed as red and the actual structure of it is drowned. One can of course specify the limits of the color bar manually to v iew the full
structure as shown here: <img alt="image1" src="../../_images/auto_color_scale_clean_small.png" /> But for a long measurement series this becomes a time consuming task.</p>
<p>In this notebook an <em>automatic color scaling</em> is presented that tries to empower the experimenter to circumvent this difficulty, while keeping possible risks in mind.</p>
<p>The risk narrowing the color scale is clearly that the image representing the data saturates in some regions and is no longer fully representative of the actual data. Especially for automatic color scaling this can become risky because without a theoretical model describing the specific measurement one cannot scientifically argue for the choice of the new limits of the color scale and possible meaningful features might be disregarded.</p>
<p>For this reason automatic color scaling is deactivated by default and has to be activated manually.</p>
</div>
<div class="section" id="Using-the-automatic-color-scale">
<h2>Using the automatic color scale<a class="headerlink" href="#Using-the-automatic-color-scale" title="Permalink to this headline">¶</a></h2>
<p>The following section presents an example of the usage of the automatic color scaling with the new <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> and the <code class="docutils literal notranslate"><span class="pre">plot_by_id</span></code> function for plotting. The same keywords will be implemented by <code class="docutils literal notranslate"><span class="pre">show_num</span></code> from <code class="docutils literal notranslate"><span class="pre">qdev-wrappers</span></code>. Let’s first make the necessary imports:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># store data in a separate db in order not to spam the actual measurement db</span>
<span class="kn">from</span> <span class="nn">qcodes</span> <span class="k">import</span> <span class="n">initialise_or_create_database_at</span><span class="p">,</span> <span class="n">new_data_set</span><span class="p">,</span> <span class="n">new_experiment</span>
<span class="kn">from</span> <span class="nn">qcodes.dataset.plotting</span> <span class="k">import</span> <span class="n">plot_by_id</span>
<span class="n">initialise_or_create_database_at</span><span class="p">(</span><span class="s1">&#39;../example.db&#39;</span><span class="p">)</span>

<span class="c1"># create an experiment for this tutorial</span>
<span class="n">new_experiment</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;tutorial_auto_color_scale&#39;</span><span class="p">,</span> <span class="n">sample_name</span><span class="o">=</span><span class="s2">&quot;outliers&quot;</span><span class="p">)</span>

<span class="c1"># import methods for creating datasets with outliers:</span>
<span class="kn">from</span> <span class="nn">qcodes.tests.dataset_generators</span> <span class="k">import</span> <span class="n">dataset_with_outliers_generator</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Upgrading database: : 0it [00:00, ?it/s]
Upgrading database: : 0it [00:00, ?it/s]
</pre></div></div>
</div>
<div class="section" id="Exampe-1:-outliers-in-homogeneous-data">
<h3>Exampe 1: outliers in homogeneous data<a class="headerlink" href="#Exampe-1:-outliers-in-homogeneous-data" title="Permalink to this headline">¶</a></h3>
<p>Here we basically reproduce the images of the introduction, where we have some smoothly structured data with some outliers that lie far outside of the range of the remaining data:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># create a new dataset with outliers</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">dataset_with_outliers_generator</span><span class="p">(</span><span class="n">new_data_set</span><span class="p">(</span><span class="s1">&#39;data_with_outliers&#39;</span><span class="p">),</span>
                                     <span class="n">low_outlier</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span> <span class="n">high_outlier</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                     <span class="n">background_noise</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>by plotting it simply by <code class="docutils literal notranslate"><span class="pre">plot_by_id</span></code> we get the full range</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ax</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">plot_by_id</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">run_id</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_plotting_auto_color_scale_9_0.png" src="../../_images/examples_plotting_auto_color_scale_9_0.png" />
</div>
</div>
<p>by adding the keyword <code class="docutils literal notranslate"><span class="pre">auto_color_scale=True</span></code> one activates the scaling:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ax</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">plot_by_id</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">auto_color_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_plotting_auto_color_scale_11_0.png" src="../../_images/examples_plotting_auto_color_scale_11_0.png" />
</div>
</div>
<p>and the actual structure of the data becomes visible.</p>
<p>Please note two further details: - The triangles that appeared at the top and the bottom of the color bar: These indicate that the color bar does not cover the full range of the data spectrum. - The clipped regions are marked with colors that are clearly not part of the color scale in order to clearly separate those regions where we cannot make any claim about any structure</p>
<p>## Details of the calculation</p>
<p>The new limits are calculated in three steps: - determine the inter quartile range (IQR), i.e. the distance between the first (q1) and the third (q3) quartile (see image below) - expand the region spanned by [q1, q3] by 1.5 x the IQR. (Yet not beyond the original limits of the min/max of the data) - limit the amount of data points clipped on each side to an amount that is described by the lower (pl) and upper (pu) cutoff percentiles. E.g. for pu=pl=0.5%, no more the white and gray areas may not
take up more than half a percent each of the total area.</p>
<p>to understand how this works lets consider the histogram of the previous example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mappable</span><span class="o">.</span><span class="n">get_array</span><span class="p">()</span>
<span class="n">pl</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">pu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="mi">97</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span>
<span class="c1"># IQR</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1"># cut off</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q1</span><span class="o">-</span><span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">q3</span><span class="o">-</span><span class="n">q1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q3</span><span class="o">+</span><span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">q3</span><span class="o">-</span><span class="n">q1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="c1"># limit through percentiles</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pl</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pu</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.lines.Line2D at 0x7ff8e7fbcac8&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_plotting_auto_color_scale_14_1.png" src="../../_images/examples_plotting_auto_color_scale_14_1.png" />
</div>
</div>
<p>The black lines mark q1 and q3 and the blue lines correspond to the interval widened by 1.5 x IQR. The red lines present the lines of the percentile cutoff, in this case 3% on each side. The red lines limit how much of the data may be cut away through the blue lines. In this specific case of 3% they are not limiting the cutoff through the IQR estimation. Please also note the barely filled bins at +-10, that represent the outliers. The new color scale therefor roughly corresponds to a threefold
increase of the steepness of color gradient.</p>
</div>
</div>
<div class="section" id="Cuttoff-Percentiles">
<h2>Cuttoff Percentiles<a class="headerlink" href="#Cuttoff-Percentiles" title="Permalink to this headline">¶</a></h2>
<p>Limiting the effect of an automatic color scale by the cutoff percentiles can be very important. To understand that consider the following example:</p>
<div class="section" id="Example-2:-data-on-noisy-background-with-outliers">
<h3>Example 2: data on noisy background with outliers<a class="headerlink" href="#Example-2:-data-on-noisy-background-with-outliers" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># create a new dataset with outliers</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">dataset_with_outliers_generator</span><span class="p">(</span><span class="n">new_data_set</span><span class="p">(</span><span class="s1">&#39;data_outside_iqr&#39;</span><span class="p">),</span>
                                     <span class="n">data_offset</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">low_outlier</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span>
                                     <span class="n">high_outlier</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ax</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">plot_by_id</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">run_id</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_plotting_auto_color_scale_20_0.png" src="../../_images/examples_plotting_auto_color_scale_20_0.png" />
</div>
</div>
<p>In this example dataset the region of interest shall be represented by the center region. Again there are outliers that render the color grading almost useless.</p>
<p>Looking at the same plot with an automatic color scale without limiting cutoff percentiles (by setting the cutoff to 50% we basically deactivate them) does not give a better result:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ax</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">plot_by_id</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">auto_color_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cutoff_percentile</span><span class="o">=</span><span class="mi">50</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_plotting_auto_color_scale_22_0.png" src="../../_images/examples_plotting_auto_color_scale_22_0.png" />
</div>
</div>
<p>Here all the relevant region is considered as outliers. To make this clearer let’s draw the histogram again:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mappable</span><span class="o">.</span><span class="n">get_array</span><span class="p">()</span>
<span class="n">pl</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">pu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="mf">99.5</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span>
<span class="c1"># IQR</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1"># cut off</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q1</span><span class="o">-</span><span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">q3</span><span class="o">-</span><span class="n">q1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">q3</span><span class="o">+</span><span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">q3</span><span class="o">-</span><span class="n">q1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="c1"># limit through percentiles</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pl</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pu</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.lines.Line2D at 0x7ff8e7dbb908&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_plotting_auto_color_scale_24_1.png" src="../../_images/examples_plotting_auto_color_scale_24_1.png" />
</div>
</div>
<p>The region of interest is represented by the right hand side structure around 0. The IQR induced limits (blue) does not capture these values. The percentile limits (0.5% here) however save the day:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ax</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">plot_by_id</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">auto_color_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cutoff_percentile</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_plotting_auto_color_scale_26_0.png" src="../../_images/examples_plotting_auto_color_scale_26_0.png" />
</div>
</div>
<p>There is some undesired clipping in the top right corner of the ROI but the structure within the ROI is relatively well resolved.</p>
</div>
<div class="section" id="Asymmetric-cutoffs">
<h3>Asymmetric cutoffs<a class="headerlink" href="#Asymmetric-cutoffs" title="Permalink to this headline">¶</a></h3>
<p>Asymmetric cutoffs can be simply defined via a tuples. So for the data of the first example we can disregard the lower outliers that take up up to five percent of the data but not allow any clipping on the upper end:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">dataset_with_outliers_generator</span><span class="p">(</span><span class="n">new_data_set</span><span class="p">(</span><span class="s1">&#39;data_with_outliers&#39;</span><span class="p">),</span>
                                     <span class="n">low_outlier</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span>
                                     <span class="n">high_outlier</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                     <span class="n">background_noise</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">plot_by_id</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">run_id</span><span class="p">,</span> <span class="n">auto_color_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cutoff_percentile</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_plotting_auto_color_scale_29_0.png" src="../../_images/examples_plotting_auto_color_scale_29_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Defaults-and-customizing-the-auto-color-scaling">
<h2>Defaults and customizing the auto color scaling<a class="headerlink" href="#Defaults-and-customizing-the-auto-color-scaling" title="Permalink to this headline">¶</a></h2>
<p>The defaults used by <code class="docutils literal notranslate"><span class="pre">plot_by_id</span></code> and <code class="docutils literal notranslate"><span class="pre">show_num</span></code> can be set in the <code class="docutils literal notranslate"><span class="pre">qcodesrc.json</span></code> files. The system default is described in <code class="docutils literal notranslate"><span class="pre">qcodes/config/qcodesrc.json</span></code> (<a class="reference external" href="https://github.com/QCoDeS/Qcodes/blob/master/qcodes/config/qcodesrc.json">online</a>) To override the default edit these values in your custom <code class="docutils literal notranslate"><span class="pre">qcodesrc.json</span></code> file in your home directory.</p>
<p>The defaults are (for detailed description see the schema file)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;auto_color_scale&quot;</span><span class="p">:{</span>
    <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
    <span class="s2">&quot;cutoff_percentile&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
    <span class="s2">&quot;color_over&quot;</span><span class="p">:</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
    <span class="s2">&quot;color_under&quot;</span><span class="p">:</span> <span class="s2">&quot;grey&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Because of the possible risks due to auto color scaling it is deactivated by default. Please remember to change the colors marking the outliers in case you should use a color map the includes white and gray.</p>
</div>
<div class="section" id="Using-auto-color-scaling-in-custom-plotting">
<h2>Using auto color scaling in custom plotting<a class="headerlink" href="#Using-auto-color-scaling-in-custom-plotting" title="Permalink to this headline">¶</a></h2>
<p>If you are using matplotlib but do not want to rely on <code class="docutils literal notranslate"><span class="pre">plot_by_id</span></code> or <code class="docutils literal notranslate"><span class="pre">show_num</span></code> you can simply call: <code class="docutils literal notranslate"><span class="pre">qcodes.utils.plotting.apply_auto_color_scale(colorbar,</span> <span class="pre">...)</span></code> and provide any matplotlib color bar to achieve the described effects.</p>
<p>If you want to use the qcodes config system for defaults call <code class="docutils literal notranslate"><span class="pre">qcodes.utils.plotting.auto_color_scale_from_config(colorbar,...)</span></code> instead.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="live_plotting.html" class="btn btn-neutral float-right" title="Live Plotting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../DataSet/Real_instruments/Example Measurements with Real Instruments.html" class="btn btn-neutral float-left" title="Example Measurements with Real Instruments" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>