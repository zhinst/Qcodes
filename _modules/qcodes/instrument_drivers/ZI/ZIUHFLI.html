

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>qcodes.instrument_drivers.ZI.ZIUHFLI &mdash; QCoDeS 0.5.2+110.g8271eec2f documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link href="../../../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> QCoDeS
          

          
          </a>

          
            
            
              <div class="version">
                0.5.2+110.g8271eec2f
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../start/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../help.html">Get Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../user/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../community/index.html">Community Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dataset/index.html">DataSet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/index.html">QCoDes API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/generated/qcodes.instrument_drivers.html">qcodes.instrument_drivers package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../changes/index.html">Changelogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples/index.html">Examples of using QCoDeS</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">QCoDeS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>qcodes.instrument_drivers.ZI.ZIUHFLI</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for qcodes.instrument_drivers.ZI.ZIUHFLI</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">sqrt</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">cast</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Dict</span>

<span class="kn">from</span> <span class="nn">qcodes.utils.helpers</span> <span class="k">import</span> <span class="n">create_on_off_val_mapping</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">zhinst.utils</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;Could not find Zurich Instruments Lab One software.</span>
<span class="s1">                         Please refer to the Zi UHF-LI User Manual for</span>
<span class="s1">                         download and installation instructions.</span>
<span class="s1">                      &#39;&#39;&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">qcodes.instrument.parameter</span> <span class="k">import</span> <span class="n">MultiParameter</span>
<span class="kn">from</span> <span class="nn">qcodes.instrument.base</span> <span class="k">import</span> <span class="n">Instrument</span>
<span class="kn">from</span> <span class="nn">qcodes.instrument.channel</span> <span class="k">import</span> <span class="n">InstrumentChannel</span><span class="p">,</span> <span class="n">ChannelList</span>
<span class="kn">from</span> <span class="nn">qcodes.utils</span> <span class="k">import</span> <span class="n">validators</span> <span class="k">as</span> <span class="n">vals</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<div class="viewcode-block" id="AUXOutputChannel"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.ZI.html#qcodes.instrument_drivers.ZI.ZIUHFLI.AUXOutputChannel">[docs]</a><span class="k">class</span> <span class="nc">AUXOutputChannel</span><span class="p">(</span><span class="n">InstrumentChannel</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="s1">&#39;ZIUHFLI&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">channum</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="c1"># TODO better validations of parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;auxouts&#39;</span><span class="p">,</span>
                                           <span class="n">channum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;scale&#39;</span><span class="p">),</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;auxouts&#39;</span><span class="p">,</span>
                                           <span class="n">channum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;scale&#39;</span><span class="p">),</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">()</span>
                           <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;preoffset&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;preoffset&#39;</span><span class="p">,</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;auxouts&#39;</span><span class="p">,</span>
                                           <span class="n">channum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;preoffset&#39;</span><span class="p">),</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;auxouts&#39;</span><span class="p">,</span>
                                           <span class="n">channum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;preoffset&#39;</span><span class="p">),</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">()</span>
                           <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;offset&#39;</span><span class="p">,</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;auxouts&#39;</span><span class="p">,</span>
                                           <span class="n">channum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;offset&#39;</span><span class="p">),</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;auxouts&#39;</span><span class="p">,</span>
                                           <span class="n">channum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;offset&#39;</span><span class="p">),</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">()</span>
                           <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;limitlower&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Lower limit&#39;</span><span class="p">,</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;auxouts&#39;</span><span class="p">,</span>
                                           <span class="n">channum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;limitlower&#39;</span><span class="p">),</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;auxouts&#39;</span><span class="p">,</span>
                                           <span class="n">channum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;limitlower&#39;</span><span class="p">),</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">()</span>
                           <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;limitupper&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Upper limit&#39;</span><span class="p">,</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;auxouts&#39;</span><span class="p">,</span>
                                           <span class="n">channum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;limitupper&#39;</span><span class="p">),</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;auxouts&#39;</span><span class="p">,</span>
                                           <span class="n">channum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;limitupper&#39;</span><span class="p">),</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">()</span>
                           <span class="p">)</span>

        <span class="c1"># TODO the validator does not catch that there are only</span>
        <span class="c1"># 2 valid output channels for AU types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Channel&#39;</span><span class="p">,</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;auxouts&#39;</span><span class="p">,</span>
                                           <span class="n">channum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;demodselect&#39;</span><span class="p">),</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;auxouts&#39;</span><span class="p">,</span>
                                           <span class="n">channum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;demodselect&#39;</span><span class="p">),</span>
                           <span class="n">get_parser</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">set_parser</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Ints</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
                           <span class="p">)</span>

        <span class="n">outputvalmapping</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Demod X&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;Demod Y&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="s1">&#39;Demod R&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="s1">&#39;Demod THETA&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                            <span class="s1">&#39;AU Cartesian&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                            <span class="s1">&#39;AU Polar&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Output&#39;</span><span class="p">,</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;auxouts&#39;</span><span class="p">,</span>
                                           <span class="n">channum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;outputselect&#39;</span><span class="p">),</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;auxouts&#39;</span><span class="p">,</span>
                                           <span class="n">channum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;outputselect&#39;</span><span class="p">),</span>
                           <span class="n">val_mapping</span><span class="o">=</span><span class="n">outputvalmapping</span>
                           <span class="p">)</span></div>

<div class="viewcode-block" id="Sweep"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.ZI.html#qcodes.instrument_drivers.ZI.ZIUHFLI.Sweep">[docs]</a><span class="k">class</span> <span class="nc">Sweep</span><span class="p">(</span><span class="n">MultiParameter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameter class for the ZIUHFLI instrument class for the sweeper.</span>

<span class="sd">    The get method returns a tuple of arrays, where each array contains the</span>
<span class="sd">    values of a signal added to the sweep (e.g. demodulator 4 phase).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        names (tuple): Tuple of strings containing the names of the sweep</span>
<span class="sd">          signals (to be measured)</span>
<span class="sd">        units (tuple): Tuple of strings containg the units of the signals</span>
<span class="sd">        shapes (tuple): Tuple of tuples each containing the Length of a</span>
<span class="sd">          signal.</span>
<span class="sd">        setpoints (tuple): Tuple of N copies of the sweep x-axis points,</span>
<span class="sd">          where N is he number of measured signals</span>
<span class="sd">        setpoint_names (tuple): Tuple of N identical strings with the name</span>
<span class="sd">          of the sweep x-axis.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># The __init__ requires that we supply names and shapes,</span>
        <span class="c1"># but there is no way to know what they could be known at this time.</span>
        <span class="c1"># They are updated via build_sweep.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,),</span> <span class="n">shapes</span><span class="o">=</span><span class="p">((</span><span class="mi">1</span><span class="p">,),),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span> <span class="o">=</span> <span class="n">instrument</span>

<div class="viewcode-block" id="Sweep.build_sweep"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.ZI.html#qcodes.instrument_drivers.ZI.ZIUHFLI.Sweep.build_sweep">[docs]</a>    <span class="k">def</span> <span class="nf">build_sweep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build a sweep with the current sweep settings. Must be called</span>
<span class="sd">        before the sweep can be executed.</span>

<span class="sd">        For developers:</span>
<span class="sd">        This is a general function for updating the sweeper.</span>
<span class="sd">        Every time a parameter of the sweeper is changed, this function</span>
<span class="sd">        must be called to update the sweeper. Although such behaviour is only</span>
<span class="sd">        strictly necessary for parameters that affect the setpoints of the</span>
<span class="sd">        Sweep parameter, having to call this function for any parameter is</span>
<span class="sd">        deemed more user friendly (easier to remember; when? -always).</span>

<span class="sd">        The function sets all (user specified) settings on the sweeper and</span>
<span class="sd">        additionally sets names, units, and setpoints for the Sweep</span>
<span class="sd">        parameter.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">signals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">_sweeper_signals</span>
        <span class="n">sweepdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">_sweepdict</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Built a sweep&#39;</span><span class="p">)</span>

        <span class="n">sigunits</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="s1">&#39;Vrms&#39;</span><span class="p">,</span> <span class="s1">&#39;Xrms&#39;</span><span class="p">:</span> <span class="s1">&#39;Vrms&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Yrms&#39;</span><span class="p">:</span> <span class="s1">&#39;Vrms&#39;</span><span class="p">,</span> <span class="s1">&#39;Rrms&#39;</span><span class="p">:</span> <span class="s1">&#39;Vrms&#39;</span><span class="p">,</span> <span class="s1">&#39;phase&#39;</span><span class="p">:</span> <span class="s1">&#39;degrees&#39;</span><span class="p">}</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">units</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sig</span> <span class="ow">in</span> <span class="n">signals</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">units</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sigunits</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">units</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>  <span class="c1"># TODO: What are good labels?</span>

        <span class="c1"># TODO: what are good set point names?</span>
        <span class="n">spnamedict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;auxouts/0/offset&#39;</span><span class="p">:</span> <span class="s1">&#39;Volts&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;auxouts/1/offset&#39;</span><span class="p">:</span> <span class="s1">&#39;Volts&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;auxouts/2/offset&#39;</span><span class="p">:</span> <span class="s1">&#39;Volts&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;auxouts/3/offset&#39;</span><span class="p">:</span> <span class="s1">&#39;Volts&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;demods/0/phaseshift&#39;</span><span class="p">:</span> <span class="s1">&#39;degrees&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;demods/1/phaseshift&#39;</span><span class="p">:</span> <span class="s1">&#39;degrees&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;demods/2/phaseshift&#39;</span><span class="p">:</span> <span class="s1">&#39;degrees&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;demods/3/phaseshift&#39;</span><span class="p">:</span> <span class="s1">&#39;degrees&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;demods/4/phaseshift&#39;</span><span class="p">:</span> <span class="s1">&#39;degrees&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;demods/5/phaseshift&#39;</span><span class="p">:</span> <span class="s1">&#39;degrees&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;demods/6/phaseshift&#39;</span><span class="p">:</span> <span class="s1">&#39;degrees&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;demods/7/phaseshift&#39;</span><span class="p">:</span> <span class="s1">&#39;degrees&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;oscs/0/freq&#39;</span><span class="p">:</span> <span class="s1">&#39;Hz&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;oscs/1/freq&#39;</span><span class="p">:</span> <span class="s1">&#39;Hz&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;sigouts/0/amplitudes/3&#39;</span><span class="p">:</span> <span class="s1">&#39;Volts&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;sigouts/0/offset&#39;</span><span class="p">:</span> <span class="s1">&#39;Volts&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;sigouts/1/amplitudes/7&#39;</span><span class="p">:</span> <span class="s1">&#39;Volts&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;sigouts/1/offset&#39;</span><span class="p">:</span> <span class="s1">&#39;Volts&#39;</span>
                      <span class="p">}</span>
        <span class="n">sp_name</span> <span class="o">=</span> <span class="n">spnamedict</span><span class="p">[</span><span class="n">sweepdict</span><span class="p">[</span><span class="s1">&#39;gridnode&#39;</span><span class="p">]]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setpoint_names</span> <span class="o">=</span> <span class="p">((</span><span class="n">sp_name</span><span class="p">,),)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">signals</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">sweepdict</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">]</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">sweepdict</span><span class="p">[</span><span class="s1">&#39;stop&#39;</span><span class="p">]</span>
        <span class="n">npts</span> <span class="o">=</span> <span class="n">sweepdict</span><span class="p">[</span><span class="s1">&#39;samplecount&#39;</span><span class="p">]</span>
        <span class="c1"># TODO: make sure that these setpoints are correct, i.e. actually</span>
        <span class="c1"># matching what the UHFLI does</span>
        <span class="c1"># TODO: support non-sequential sweep mode</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sweepdict</span><span class="p">[</span><span class="s1">&#39;scan&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Only sequential scanning is supported.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sweepdict</span><span class="p">[</span><span class="s1">&#39;xmapping&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sw</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">npts</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logstart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="n">logstop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
            <span class="n">sw</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">logstart</span><span class="p">,</span> <span class="n">logstop</span><span class="p">,</span> <span class="n">npts</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setpoints</span> <span class="o">=</span> <span class="p">((</span><span class="n">sw</span><span class="p">,),)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">signals</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span> <span class="o">=</span> <span class="p">((</span><span class="n">npts</span><span class="p">,),)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">signals</span><span class="p">)</span>

        <span class="c1"># Now actually send  the settings to the instrument</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">setting</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="n">sweepdict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">setting</span> <span class="o">=</span> <span class="s1">&#39;sweep/&#39;</span> <span class="o">+</span> <span class="n">setting</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">sweeper</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">setting</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">sweep_correctly_built</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Sweep.get_raw"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.ZI.html#qcodes.instrument_drivers.ZI.ZIUHFLI.Sweep.get_raw">[docs]</a>    <span class="k">def</span> <span class="nf">get_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the sweeper and return the data corresponding to the</span>
<span class="sd">        subscribed signals.</span>

<span class="sd">        Returns:</span>

<span class="sd">            tuple: Tuple containg N numpy arrays where N is the number</span>
<span class="sd">              of signals added to the sweep.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If no signals have been added to the sweep</span>
<span class="sd">            ValueError: If a sweep setting has been modified since</span>
<span class="sd">              the last sweep, but Sweep.build_sweep has not been run</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">daq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">daq</span>
        <span class="n">signals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">_sweeper_signals</span>
        <span class="n">sweeper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">sweeper</span>

        <span class="k">if</span> <span class="n">signals</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No signals selected! Can not perform sweep.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">sweep_correctly_built</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The sweep has not been correctly built.&#39;</span> <span class="o">+</span>
                             <span class="s1">&#39; Please run Sweep.build_sweep.&#39;</span><span class="p">)</span>

        <span class="c1"># We must enable the demodulators we use.</span>
        <span class="c1"># After the sweep, they should be returned to their original state</span>
        <span class="n">streamsettings</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># This list keeps track of the pre-sweep settings</span>
        <span class="k">for</span> <span class="n">sigstr</span> <span class="ow">in</span> <span class="n">signals</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sigstr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">dev</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">dmnum</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

            <span class="c1"># If the setting has never changed, get returns an empty dict.</span>
            <span class="c1"># In that case, we assume that it&#39;s zero (factory default)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">toget</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="s1">&#39;enable&#39;</span><span class="p">)</span>
                <span class="c1"># ZI like nesting inside dicts...</span>
                <span class="n">setting</span> <span class="o">=</span> <span class="n">daq</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">toget</span><span class="p">)[</span><span class="n">dev</span><span class="p">][</span><span class="s1">&#39;demods&#39;</span><span class="p">][</span><span class="n">dmnum</span><span class="p">][</span><span class="s1">&#39;enable&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">setting</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">streamsettings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
            <span class="n">daq</span><span class="o">.</span><span class="n">setInt</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="s1">&#39;enable&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># We potentially subscribe several times to the same demodulator,</span>
            <span class="c1"># but that should not be a problem</span>
            <span class="n">sweeper</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="n">sweeper</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">sweeper_timeout</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">sweeper</span><span class="o">.</span><span class="n">finished</span><span class="p">():</span>  <span class="c1"># Wait until the sweep is done/timeout</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>  <span class="c1"># Check every 200 ms whether the sweep is done</span>
            <span class="c1"># Here we could read intermediate data via:</span>
            <span class="c1"># data = sweeper.read(True)...</span>
            <span class="c1"># and process it while the sweep is completing.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="c1"># If for some reason the sweep is blocking, force the end of the</span>
                <span class="c1"># measurement.</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Sweep still not finished, forcing finish...&quot;</span><span class="p">)</span>
                <span class="c1"># should exit function with error message instead of returning</span>
                <span class="n">sweeper</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>

        <span class="n">return_flat_dict</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">sweeper</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">return_flat_dict</span><span class="p">)</span>

        <span class="n">sweeper</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">sigstr</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">streamsettings</span><span class="p">,</span> <span class="n">signals</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sigstr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">daq</span><span class="o">.</span><span class="n">setInt</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="s1">&#39;enable&#39;</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parsesweepdata</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_parsesweepdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sweepresult</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse the raw result of a sweep into just the data asked for by the</span>
<span class="sd">        added sweeper signals. Used by Sweep.get.</span>

<span class="sd">        Args:</span>
<span class="sd">            sweepresult (dict): The dict returned by sweeper.read</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: The requested signals in a tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;Aux Input 1&#39;</span><span class="p">:</span> <span class="s1">&#39;auxin0&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Aux Input 2&#39;</span><span class="p">:</span> <span class="s1">&#39;auxin1&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;phase&#39;</span><span class="p">:</span> <span class="s1">&#39;phase&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;Xrms&#39;</span><span class="p">:</span> <span class="s1">&#39;xpwr&#39;</span><span class="p">,</span> <span class="s1">&#39;Yrms&#39;</span><span class="p">:</span> <span class="s1">&#39;ypwr&#39;</span><span class="p">,</span> <span class="s1">&#39;Rrms&#39;</span><span class="p">:</span> <span class="s1">&#39;rpwr&#39;</span><span class="p">}</span>
        <span class="n">returndata</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">signal</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">_sweeper_signals</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">sweepresult</span><span class="p">[</span><span class="n">path</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">trans</span><span class="p">[</span><span class="n">attr</span><span class="p">]]</span>
            <span class="n">returndata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">returndata</span><span class="p">)</span></div>


<div class="viewcode-block" id="Scope"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.ZI.html#qcodes.instrument_drivers.ZI.ZIUHFLI.Scope">[docs]</a><span class="k">class</span> <span class="nc">Scope</span><span class="p">(</span><span class="n">MultiParameter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameter class for the ZI UHF-LI Scope Channel 1</span>

<span class="sd">    The .get method launches an acquisition and returns a tuple of two</span>
<span class="sd">    np.arrays</span>
<span class="sd">    FFT mode is NOT supported.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        names (tuple): Tuple of strings containing the names of the sweep</span>
<span class="sd">          signals (to be measured)</span>
<span class="sd">        units (tuple): Tuple of strings containg the units of the signals</span>
<span class="sd">        shapes (tuple): Tuple of tuples each containing the Length of a</span>
<span class="sd">          signal.</span>
<span class="sd">        setpoints (tuple): Tuple of N copies of the sweep x-axis points,</span>
<span class="sd">          where N is he number of measured signals</span>
<span class="sd">        setpoint_names (tuple): Tuple of N identical strings with the name</span>
<span class="sd">          of the sweep x-axis.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">instrument</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># The __init__ requires that we supply names and shapes,</span>
        <span class="c1"># but there is no way to know what they could be known at this time.</span>
        <span class="c1"># They are updated via build_scope.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,),</span> <span class="n">shapes</span><span class="o">=</span><span class="p">((</span><span class="mi">1</span><span class="p">,),),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span> <span class="o">=</span> <span class="n">instrument</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scopeactions</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of callables</span>

<div class="viewcode-block" id="Scope.add_post_trigger_action"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.ZI.html#qcodes.instrument_drivers.ZI.ZIUHFLI.Scope.add_post_trigger_action">[docs]</a>    <span class="k">def</span> <span class="nf">add_post_trigger_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an action to be performed immediately after the trigger</span>
<span class="sd">        has been armed. The action must be a callable taking zero</span>
<span class="sd">        arguments</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopeactions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scopeactions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">post_trigger_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopeactions</span>

<div class="viewcode-block" id="Scope.prepare_scope"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.ZI.html#qcodes.instrument_drivers.ZI.ZIUHFLI.Scope.prepare_scope">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare the scope for a measurement. Must immediately preceed a</span>
<span class="sd">        measurement.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Preparing the scope&#39;</span><span class="p">)</span>

        <span class="c1"># A convenient reference</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">parameters</span>

        <span class="c1"># First figure out what the user has asked for</span>
        <span class="n">chans</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="mi">2</span><span class="p">:</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="mi">3</span><span class="p">:</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)}</span>
        <span class="n">channels</span> <span class="o">=</span> <span class="n">chans</span><span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;scope_channels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()]</span>

        <span class="n">npts</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;scope_length&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="c1"># Find out whether segments are enabled</span>
        <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;scope_segments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ON&#39;</span><span class="p">:</span>
            <span class="n">segs</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;scope_segments_count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">segs</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">inputunits</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Signal Input 1&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Signal Input 2&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Trig Input 1&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Trig Input 2&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Aux Output 1&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Aux Output 2&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Aux Output 3&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Aux Output 4&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Aux In 1 Ch 1&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Aux In 1 Ch 2&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Osc phi Demod 4&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;osc phi Demod 8&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;AU Cartesian 1&#39;</span><span class="p">:</span> <span class="s1">&#39;arb. un.&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;AU Cartesian 2&#39;</span><span class="p">:</span> <span class="s1">&#39;arb. un&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;AU Polar 1&#39;</span><span class="p">:</span> <span class="s1">&#39;arb. un.&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;AU Polar 2&#39;</span><span class="p">:</span> <span class="s1">&#39;arb. un.&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 1 X&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 1 Y&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 1 R&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 1 Phase&#39;</span><span class="p">:</span>  <span class="s1">&#39;&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 2 X&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 2 Y&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 2 R&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 2 Phase&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 3 X&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 3 Y&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 3 R&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 3 Phase&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 4 X&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 4 Y&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 4 R&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 4 Phase&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 5 X&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 5 Y&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 5 R&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 5 Phase&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 6 X&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 6 Y&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 6 R&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 6 Phase&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 7 X&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 7 Y&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 7 R&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 7 Phase&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 8 X&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 8 Y&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 8 R&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 8 Phase&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                      <span class="p">}</span>

        <span class="c1">#TODO: what are good names?</span>
        <span class="n">inputnames</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Signal Input 1&#39;</span><span class="p">:</span> <span class="s1">&#39;Sig. In 1&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Signal Input 2&#39;</span><span class="p">:</span> <span class="s1">&#39;Sig. In 2&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Trig Input 1&#39;</span><span class="p">:</span> <span class="s1">&#39;Trig. In 1&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Trig Input 2&#39;</span><span class="p">:</span> <span class="s1">&#39;Trig. In 2&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Aux Output 1&#39;</span><span class="p">:</span> <span class="s1">&#39;Aux. Out 1&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Aux Output 2&#39;</span><span class="p">:</span> <span class="s1">&#39;Aux. Out 2&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Aux Output 3&#39;</span><span class="p">:</span> <span class="s1">&#39;Aux. Out 3&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Aux Output 4&#39;</span><span class="p">:</span> <span class="s1">&#39;Aux. Out 4&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Aux In 1 Ch 1&#39;</span><span class="p">:</span> <span class="s1">&#39;Aux. In 1 Ch 1&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Aux In 1 Ch 2&#39;</span><span class="p">:</span> <span class="s1">&#39;Aux. In 1 Ch 2&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Osc phi Demod 4&#39;</span><span class="p">:</span> <span class="s1">&#39;Demod. 4 Phase&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;osc phi Demod 8&#39;</span><span class="p">:</span> <span class="s1">&#39;Demod. 8 Phase&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;AU Cartesian 1&#39;</span><span class="p">:</span> <span class="s1">&#39;AU Cartesian 1&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;AU Cartesian 2&#39;</span><span class="p">:</span> <span class="s1">&#39;AU Cartesian 2&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;AU Polar 1&#39;</span><span class="p">:</span> <span class="s1">&#39;AU Polar 1&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;AU Polar 2&#39;</span><span class="p">:</span> <span class="s1">&#39;AU Polar 2&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 1 X&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 1 X&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 1 Y&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 1 Y&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 1 R&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 1 R&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 1 Phase&#39;</span><span class="p">:</span>  <span class="s1">&#39;Demodulator 1 Phase&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 2 X&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 2 X&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 2 Y&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 2 Y&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 2 R&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 2 R&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 2 Phase&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 2 Phase&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 3 X&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 3 X&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 3 Y&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 3 Y&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 3 R&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 3 R&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 3 Phase&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 3 Phase&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 4 X&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 4 X&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 4 Y&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 4 Y&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 4 R&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 4 R&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 4 Phase&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 4 Phase&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 5 X&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 5 X&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 5 Y&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 5 Y&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 5 R&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 5 R&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 5 Phase&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 5 Phase&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 6 X&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 6 X&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 6 Y&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 6 Y&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 6 R&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 6 R&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 6 Phase&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 6 Phase&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 7 X&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 7 X&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 7 Y&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 7 Y&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 7 R&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 7 R&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 7 Phase&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 7 Phase&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 8 X&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 8 X&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 8 Y&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 8 Y&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 8 R&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 8 R&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 8 Phase&#39;</span><span class="p">:</span> <span class="s1">&#39;Demodulator 8 Phase&#39;</span><span class="p">,</span>
                      <span class="p">}</span>

        <span class="c1"># Make the basic setpoints (the x-axis)</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;scope_duration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;scope_trig_delay&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">starttime</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;scope_trig_reference&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">*</span><span class="mf">0.01</span><span class="o">*</span><span class="n">duration</span> <span class="o">+</span> <span class="n">delay</span>
        <span class="n">stoptime</span> <span class="o">=</span> <span class="n">starttime</span> <span class="o">+</span> <span class="n">duration</span>

        <span class="n">setpointlist</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">starttime</span><span class="p">,</span> <span class="n">stoptime</span><span class="p">,</span> <span class="n">npts</span><span class="p">))</span>  <span class="c1"># x-axis</span>
        <span class="n">spname</span> <span class="o">=</span> <span class="s1">&#39;Time&#39;</span>
        <span class="n">namestr</span> <span class="o">=</span> <span class="s2">&quot;scope_channel</span><span class="si">{}</span><span class="s2">_input&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">name1</span> <span class="o">=</span> <span class="n">inputnames</span><span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="n">namestr</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()]</span>
        <span class="n">unit1</span> <span class="o">=</span> <span class="n">inputunits</span><span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="n">namestr</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()]</span>
        <span class="n">namestr</span> <span class="o">=</span> <span class="s2">&quot;scope_channel</span><span class="si">{}</span><span class="s2">_input&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">name2</span> <span class="o">=</span> <span class="n">inputnames</span><span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="n">namestr</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()]</span>
        <span class="n">unit2</span> <span class="o">=</span> <span class="n">inputunits</span><span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="n">namestr</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setpoints</span> <span class="o">=</span> <span class="p">((</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">segs</span><span class="p">)),</span> <span class="p">(</span><span class="n">setpointlist</span><span class="p">,)</span><span class="o">*</span><span class="n">segs</span><span class="p">),)</span><span class="o">*</span><span class="mi">2</span>
        <span class="c1">#self.setpoints = ((setpointlist,)*segs,)*2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setpoint_names</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;Segments&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Segments&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">(</span><span class="n">name1</span><span class="p">,</span> <span class="n">name2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="p">(</span><span class="n">unit1</span><span class="p">,</span> <span class="n">unit2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Scope channel 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Scope channel 2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span> <span class="o">=</span> <span class="p">((</span><span class="n">segs</span><span class="p">,</span> <span class="n">npts</span><span class="p">),</span> <span class="p">(</span><span class="n">segs</span><span class="p">,</span> <span class="n">npts</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">sync</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">scope_correctly_built</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Scope.get_raw"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.ZI.html#qcodes.instrument_drivers.ZI.ZIUHFLI.Scope.get_raw">[docs]</a>    <span class="k">def</span> <span class="nf">get_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Acquire data from the scope.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: Tuple of two n X m arrays where n is the number of segments</span>
<span class="sd">                and m is the number of points in the scope trace.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the scope has not been prepared by running the</span>
<span class="sd">                prepare_scope function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Scope get method called&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">scope_correctly_built</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Scope not properly prepared. Please run &#39;</span>
                             <span class="s1">&#39;prepare_scope before measuring.&#39;</span><span class="p">)</span>

        <span class="c1"># A convenient reference</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">parameters</span>
        <span class="c1">#</span>
        <span class="n">chans</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="mi">2</span><span class="p">:</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="mi">3</span><span class="p">:</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)}</span>
        <span class="n">channels</span> <span class="o">=</span> <span class="n">chans</span><span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;scope_channels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()]</span>

        <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;scope_trig_holdoffmode&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_latest</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;events&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Scope trigger holdoff in number of &#39;</span>
                                      <span class="s1">&#39;events not supported. Please specify &#39;</span>
                                      <span class="s1">&#39;holdoff in seconds.&#39;</span><span class="p">)</span>

        <span class="c1">#######################################################</span>
        <span class="c1"># The following steps SEEM to give the correct result</span>

        <span class="c1"># Make sure all settings have taken effect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">sync</span><span class="p">()</span>

        <span class="c1"># Calculate the time needed for the measurement. We often have failed</span>
        <span class="c1"># measurements, so a timeout is needed.</span>
        <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;scope_segments&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ON&#39;</span><span class="p">:</span>
            <span class="n">segs</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;scope_segments_count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">segs</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">deadtime</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;scope_trig_holdoffseconds&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_latest</span><span class="p">()</span>
        <span class="c1"># We add one second to account for latencies and random delays</span>
        <span class="n">meas_time</span> <span class="o">=</span> <span class="n">segs</span><span class="o">*</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;scope_duration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">+</span><span class="n">deadtime</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">npts</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;scope_length&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="n">zi_error</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">error_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">num_retries</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">timedout</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">zi_error</span> <span class="ow">or</span> <span class="n">timedout</span><span class="p">)</span> <span class="ow">and</span> <span class="n">error_counter</span> <span class="o">&lt;</span> <span class="n">num_retries</span><span class="p">:</span>
            <span class="c1"># one shot per trigger. This needs to be set every time</span>
            <span class="c1"># a the scope is enabled as below using scope_runstop</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># we wrap this in try finally to ensure that</span>
                <span class="c1"># scope.finish is always called even if the</span>
                <span class="c1"># measurement is interrupted</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">setInt</span><span class="p">(</span><span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">/scopes/0/single&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>


                <span class="n">scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">scope</span>
                <span class="n">scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;scopeModule/clearhistory&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="c1"># Start the scope triggering/acquiring</span>
                <span class="c1"># set /dev/scopes/0/enable to 1</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;scope_runstop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;run&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">sync</span><span class="p">()</span>

                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Starting ZI scope acquisition.&#39;</span><span class="p">)</span>
                <span class="c1"># Start something... hauling data from the scopeModule?</span>
                <span class="n">scope</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

                <span class="c1"># Now perform actions that may produce data, e.g. running an AWG</span>
                <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopeactions</span><span class="p">:</span>
                    <span class="n">action</span><span class="p">()</span>

                <span class="n">starttime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">timedout</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="n">progress</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">progress</span><span class="p">()</span>
                <span class="k">while</span> <span class="n">progress</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Scope progress is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">progress</span><span class="p">))</span>
                    <span class="n">progress</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">progress</span><span class="p">()</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># This while+sleep is how ZI engineers do it</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">starttime</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="o">*</span><span class="n">meas_time</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">timedout</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scopeModule/*&quot;</span><span class="p">)</span>
                <span class="n">zi_error</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

                <span class="c1"># Stop the scope from running</span>
                <span class="n">params</span><span class="p">[</span><span class="s1">&#39;scope_runstop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;stop&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">timedout</span> <span class="ow">or</span> <span class="n">zi_error</span><span class="p">):</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;[+] ZI scope acquisition completed OK&#39;</span><span class="p">)</span>
                    <span class="n">rawdata</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                    <span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="n">rawdata</span><span class="p">:</span>
                        <span class="n">zi_error</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">rawdata</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scopedataparser</span><span class="p">(</span><span class="n">rawdata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instrument</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
                                                 <span class="n">npts</span><span class="p">,</span> <span class="n">segs</span><span class="p">,</span> <span class="n">channels</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;[-] ZI scope acquisition attempt </span><span class="si">{}</span><span class="s1"> &#39;</span>
                                <span class="s1">&#39;failed, Timeout: </span><span class="si">{}</span><span class="s1">, Error: </span><span class="si">{}</span><span class="s1">, &#39;</span>
                                <span class="s1">&#39;retrying&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">error_counter</span><span class="p">,</span> <span class="n">timedout</span><span class="p">,</span> <span class="n">zi_error</span><span class="p">))</span>
                    <span class="n">rawdata</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="n">error_counter</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">error_counter</span> <span class="o">&gt;=</span> <span class="n">num_retries</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;[+] ZI scope acquisition failed, maximum number&#39;</span>
                              <span class="s1">&#39;of retries performed. No data returned&#39;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;[+] ZI scope acquisition failed, maximum number&#39;</span>
                              <span class="s1">&#39;of retries performed. No data returned&#39;</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="c1"># cleanup and make ready for next scope acquisition</span>
                <span class="n">scope</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>

        <span class="n">t_stop</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;scope get method returning after </span><span class="si">{}</span><span class="s1"> s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t_stop</span> <span class="o">-</span>
                                                                <span class="n">t_start</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">data</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_scopedataparser</span><span class="p">(</span><span class="n">rawdata</span><span class="p">,</span> <span class="n">deviceID</span><span class="p">,</span> <span class="n">scopelength</span><span class="p">,</span> <span class="n">segments</span><span class="p">,</span> <span class="n">channels</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cast the scope return value dict into a tuple.</span>

<span class="sd">        Args:</span>
<span class="sd">            rawdata (dict): The return of scopeModule.read()</span>
<span class="sd">            deviceID (str): The device ID string of the instrument.</span>
<span class="sd">            scopelength (int): The length of each segment</span>
<span class="sd">            segments (int): The number of segments</span>
<span class="sd">            channels (tuple): Tuple of two bools controlling what data to return</span>
<span class="sd">                (True, False) will return data for channel 1 etc.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: A 2-tuple of either None or np.array with dimensions</span>
<span class="sd">                segments x scopelength.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">rawdata</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">deviceID</span><span class="p">)][</span><span class="s1">&#39;scopes&#39;</span><span class="p">][</span><span class="s1">&#39;0&#39;</span><span class="p">][</span><span class="s1">&#39;wave&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">ch1data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;wave&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">segments</span><span class="p">,</span> <span class="n">scopelength</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ch1data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">ch2data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;wave&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">segments</span><span class="p">,</span> <span class="n">scopelength</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ch2data</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">ch1data</span><span class="p">,</span> <span class="n">ch2data</span><span class="p">)</span></div>


<div class="viewcode-block" id="ZIUHFLI"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.ZI.html#qcodes.instrument_drivers.ZI.ZIUHFLI.ZIUHFLI">[docs]</a><span class="k">class</span> <span class="nc">ZIUHFLI</span><span class="p">(</span><span class="n">Instrument</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    QCoDeS driver for ZI UHF-LI.</span>

<span class="sd">    Currently implementing demodulator settings and the sweeper functionality.</span>

<span class="sd">    Requires ZI Lab One software to be installed on the computer running QCoDeS.</span>
<span class="sd">    Furthermore, the Data Server and Web Server must be running and a connection</span>
<span class="sd">    between the two must be made.</span>

<span class="sd">    TODOs:</span>
<span class="sd">        * Add zoom-FFT</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">device_ID</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an instance of the instrument.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): The internal QCoDeS name of the instrument</span>
<span class="sd">            device_ID (str): The device name as listed in the web server.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_level</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">zisession</span> <span class="o">=</span> <span class="n">zhinst</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">create_api_session</span><span class="p">(</span><span class="n">device_ID</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_level</span><span class="p">)</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">)</span> <span class="o">=</span> <span class="n">zisession</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">setDebugLevel</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="c1"># create (instantiate) an instance of each module we will use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweeper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">sweep</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweeper</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;sweep/device&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">scopeModule</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">/scopes/0/wave&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>
        <span class="c1">########################################</span>
        <span class="c1"># INSTRUMENT PARAMETERS</span>

        <span class="c1">########################################</span>
        <span class="c1"># Oscillators</span>

        <span class="n">number_of_oscillators</span> <span class="o">=</span> <span class="mi">8</span> <span class="k">if</span> <span class="s1">&#39;MF&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">oscs</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_of_oscillators</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;oscillator</span><span class="si">{}</span><span class="s1">_freq&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oscs</span><span class="p">),</span>
                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Frequency of oscillator </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oscs</span><span class="p">),</span>
                               <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span>
                               <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;oscs&#39;</span><span class="p">,</span>
                                                <span class="n">oscs</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">),</span>
                               <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;oscs&#39;</span><span class="p">,</span>
                                                <span class="n">oscs</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">),</span>
                               <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">600e6</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;demod</span><span class="si">{}</span><span class="s1">_oscillator&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oscs</span><span class="p">),</span>
                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Selected oscillator </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oscs</span><span class="p">),</span>
                               <span class="n">docstring</span><span class="o">=</span><span class="s2">&quot;Connects the demodulator with the &quot;</span>
                                         <span class="s2">&quot;supplied oscillator.&quot;</span><span class="p">,</span>
                               <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">oscs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;oscselect&#39;</span><span class="p">),</span>
                               <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">oscs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;oscselect&#39;</span><span class="p">),</span>
                               <span class="n">val_mapping</span><span class="o">=</span><span class="p">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>
                                            <span class="nb">range</span><span class="p">(</span><span class="n">number_of_oscillators</span><span class="p">)})</span>

        <span class="c1">########################################</span>
        <span class="c1"># DEMODULATOR PARAMETERS</span>

        <span class="k">for</span> <span class="n">demod</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;demod</span><span class="si">{}</span><span class="s1">_order&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">demod</span><span class="p">),</span>
                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Filter order&#39;</span><span class="p">,</span>
                               <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">demod</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">),</span>
                               <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">demod</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">),</span>
                               <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Ints</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
                               <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;demod</span><span class="si">{}</span><span class="s1">_harmonic&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">demod</span><span class="p">),</span>
                               <span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Reference frequency multiplication&#39;</span> <span class="o">+</span>
                                      <span class="s1">&#39; factor&#39;</span><span class="p">),</span>
                               <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">demod</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;harmonic&#39;</span><span class="p">),</span>
                               <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">demod</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;harmonic&#39;</span><span class="p">),</span>
                               <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Ints</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">999</span><span class="p">)</span>
                               <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;demod</span><span class="si">{}</span><span class="s1">_timeconstant&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">demod</span><span class="p">),</span>
                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Filter time constant&#39;</span><span class="p">,</span>
                               <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">demod</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;timeconstant&#39;</span><span class="p">),</span>
                               <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">demod</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;timeconstant&#39;</span><span class="p">),</span>
                               <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span>
                               <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;demod</span><span class="si">{}</span><span class="s1">_samplerate&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">demod</span><span class="p">),</span>
                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sample rate&#39;</span><span class="p">,</span>
                               <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">demod</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">),</span>
                               <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">demod</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">),</span>
                               <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;Sa/s&#39;</span><span class="p">,</span>
                               <span class="n">docstring</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                                         Note: the value inserted by the user</span>
<span class="s2">                                         may be approximated to the</span>
<span class="s2">                                         nearest value supported by the</span>
<span class="s2">                                         instrument.</span>
<span class="s2">                                         &quot;&quot;&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;demod</span><span class="si">{}</span><span class="s1">_phaseshift&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">demod</span><span class="p">),</span>
                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Phase shift&#39;</span><span class="p">,</span>
                               <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;degrees&#39;</span><span class="p">,</span>
                               <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">demod</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;phaseshift&#39;</span><span class="p">),</span>
                               <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">demod</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;phaseshift&#39;</span><span class="p">)</span>
                               <span class="p">)</span>

            <span class="c1"># val_mapping for the demodX_signalin parameter</span>
            <span class="n">dmsigins</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Sig In 1&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="s1">&#39;Sig In 2&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="s1">&#39;Trigger 1&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="s1">&#39;Trigger 2&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                        <span class="s1">&#39;Aux Out 1&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                        <span class="s1">&#39;Aux Out 2&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                        <span class="s1">&#39;Aux Out 3&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
                        <span class="s1">&#39;Aux Out 4&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                        <span class="s1">&#39;Aux In 1&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                        <span class="s1">&#39;Aux In 2&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
                        <span class="s1">&#39;Phi Demod 4&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                        <span class="s1">&#39;Phi Demod 8&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;demod</span><span class="si">{}</span><span class="s1">_signalin&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">demod</span><span class="p">),</span>
                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Signal input&#39;</span><span class="p">,</span>
                               <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">demod</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="s1">&#39;adcselect&#39;</span><span class="p">),</span>
                               <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">demod</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;adcselect&#39;</span><span class="p">),</span>
                               <span class="n">val_mapping</span><span class="o">=</span><span class="n">dmsigins</span><span class="p">,</span>
                               <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="n">dmsigins</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                               <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;demod</span><span class="si">{}</span><span class="s1">_sinc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">demod</span><span class="p">),</span>
                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sinc filter&#39;</span><span class="p">,</span>
                               <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">demod</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;sinc&#39;</span><span class="p">),</span>
                               <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">demod</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;sinc&#39;</span><span class="p">),</span>
                               <span class="n">val_mapping</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ON&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;OFF&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                               <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;ON&#39;</span><span class="p">,</span> <span class="s1">&#39;OFF&#39;</span><span class="p">)</span>
                               <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;demod</span><span class="si">{}</span><span class="s1">_streaming&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">demod</span><span class="p">),</span>
                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data streaming&#39;</span><span class="p">,</span>
                               <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">demod</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;enable&#39;</span><span class="p">),</span>
                               <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">demod</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;enable&#39;</span><span class="p">),</span>
                               <span class="n">val_mapping</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ON&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;OFF&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                               <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;ON&#39;</span><span class="p">,</span> <span class="s1">&#39;OFF&#39;</span><span class="p">)</span>
                               <span class="p">)</span>

            <span class="n">dmtrigs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Continuous&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                       <span class="s1">&#39;Trigger in 3 Rise&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                       <span class="s1">&#39;Trigger in 3 Fall&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                       <span class="s1">&#39;Trigger in 3 Both&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                       <span class="s1">&#39;Trigger in 3 High&#39;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
                       <span class="s1">&#39;Trigger in 3 Low&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
                       <span class="s1">&#39;Trigger in 4 Rise&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                       <span class="s1">&#39;Trigger in 4 Fall&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                       <span class="s1">&#39;Trigger in 4 Both&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
                       <span class="s1">&#39;Trigger in 4 High&#39;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
                       <span class="s1">&#39;Trigger in 4 Low&#39;</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
                       <span class="s1">&#39;Trigger in 3|4 Rise&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                       <span class="s1">&#39;Trigger in 3|4 Fall&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                       <span class="s1">&#39;Trigger in 3|4 Both&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
                       <span class="s1">&#39;Trigger in 3|4 High&#39;</span><span class="p">:</span> <span class="mi">160</span><span class="p">,</span>
                       <span class="s1">&#39;Trigger in 3|4 Low&#39;</span><span class="p">:</span> <span class="mi">80</span><span class="p">}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;demod</span><span class="si">{}</span><span class="s1">_trigger&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">demod</span><span class="p">),</span>
                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Trigger&#39;</span><span class="p">,</span>
                               <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">demod</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;trigger&#39;</span><span class="p">),</span>
                               <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">demod</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;trigger&#39;</span><span class="p">),</span>
                               <span class="n">val_mapping</span><span class="o">=</span><span class="n">dmtrigs</span><span class="p">,</span>
                               <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="n">dmtrigs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                               <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;demod</span><span class="si">{}</span><span class="s1">_sample&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">demod</span><span class="p">),</span>
                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Demod sample&#39;</span><span class="p">,</span>
                               <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;demods&#39;</span><span class="p">,</span>
                                               <span class="n">demod</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;sample&#39;</span><span class="p">),</span>
                               <span class="n">snapshot_value</span><span class="o">=</span><span class="kc">False</span>
                               <span class="p">)</span>

            <span class="k">for</span> <span class="n">demod_param</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;phi&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">demod_param</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">):</span>
                    <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;V&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;deg&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;demod</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">demod</span><span class="p">,</span> <span class="n">demod_param</span><span class="p">),</span>
                                   <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Demod </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">demod</span><span class="p">,</span> <span class="n">demod_param</span><span class="p">),</span>
                                   <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_demod_sample</span><span class="p">,</span>
                                                   <span class="n">demod</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">demod_param</span><span class="p">),</span>
                                   <span class="n">snapshot_value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">unit</span><span class="o">=</span><span class="n">unit</span>
                                   <span class="p">)</span>

        <span class="c1">########################################</span>
        <span class="c1"># SIGNAL INPUTS</span>

        <span class="k">for</span> <span class="n">sigin</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;signal_input</span><span class="si">{}</span><span class="s1">_range&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigin</span><span class="p">),</span>
                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Input range&#39;</span><span class="p">,</span>
                               <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;sigins&#39;</span><span class="p">,</span>
                                               <span class="n">sigin</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">),</span>
                               <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;sigins&#39;</span><span class="p">,</span>
                                               <span class="n">sigin</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">),</span>
                               <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;V&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;signal_input</span><span class="si">{}</span><span class="s1">_scaling&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigin</span><span class="p">),</span>
                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Input scaling&#39;</span><span class="p">,</span>
                               <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;sigins&#39;</span><span class="p">,</span>
                                               <span class="n">sigin</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;scaling&#39;</span><span class="p">),</span>
                               <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;sigins&#39;</span><span class="p">,</span>
                                               <span class="n">sigin</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;scaling&#39;</span><span class="p">),</span>
                               <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;signal_input</span><span class="si">{}</span><span class="s1">_AC&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigin</span><span class="p">),</span>
                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;AC coupling&#39;</span><span class="p">,</span>
                               <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span><span class="s1">&#39;sigins&#39;</span><span class="p">,</span>
                                               <span class="n">sigin</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ac&#39;</span><span class="p">),</span>
                               <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;sigins&#39;</span><span class="p">,</span>
                                               <span class="n">sigin</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ac&#39;</span><span class="p">),</span>
                               <span class="n">val_mapping</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ON&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;OFF&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                               <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;ON&#39;</span><span class="p">,</span> <span class="s1">&#39;OFF&#39;</span><span class="p">)</span>
                               <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;signal_input</span><span class="si">{}</span><span class="s1">_impedance&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigin</span><span class="p">),</span>
                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Input impedance&#39;</span><span class="p">,</span>
                               <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;sigins&#39;</span><span class="p">,</span>
                                                <span class="n">sigin</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;imp50&#39;</span><span class="p">),</span>
                               <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;sigins&#39;</span><span class="p">,</span>
                                               <span class="n">sigin</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;imp50&#39;</span><span class="p">),</span>
                               <span class="n">val_mapping</span><span class="o">=</span><span class="p">{</span><span class="mi">50</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                               <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
                               <span class="p">)</span>

            <span class="n">sigindiffs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Off&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Inverted&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Input 1 - Input 2&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                          <span class="s1">&#39;Input 2 - Input 1&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;signal_input</span><span class="si">{}</span><span class="s1">_diff&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigin</span><span class="p">),</span>
                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Input signal subtraction&#39;</span><span class="p">,</span>
                               <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;sigins&#39;</span><span class="p">,</span>
                                                <span class="n">sigin</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;diff&#39;</span><span class="p">),</span>
                               <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;sigins&#39;</span><span class="p">,</span>
                                               <span class="n">sigin</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;diff&#39;</span><span class="p">),</span>
                               <span class="n">val_mapping</span><span class="o">=</span><span class="n">sigindiffs</span><span class="p">,</span>
                               <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="n">sigindiffs</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>

        <span class="c1">########################################</span>
        <span class="c1"># SIGNAL OUTPUTS</span>
        <span class="n">outputamps</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;amplitudes/3&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;amplitudes/7&#39;</span><span class="p">}</span>
        <span class="n">outputampenable</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;enables/3&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;enables/7&#39;</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">sigout</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_on&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigout</span><span class="p">),</span>
                                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Turn signal output on and off.&#39;</span><span class="p">,</span>
                                <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sigout_setter</span><span class="p">,</span>
                                                <span class="n">sigout</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">),</span>
                                <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sigout_getter</span><span class="p">,</span>
                                                <span class="n">sigout</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">),</span>
                                <span class="n">val_mapping</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ON&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;OFF&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                                <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;ON&#39;</span><span class="p">,</span> <span class="s1">&#39;OFF&#39;</span><span class="p">)</span> <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_imp50&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigout</span><span class="p">),</span>
                                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Switch to turn on 50 Ohm impedance&#39;</span><span class="p">,</span>
                                <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sigout_setter</span><span class="p">,</span>
                                                <span class="n">sigout</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;imp50&#39;</span><span class="p">),</span>
                                <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sigout_getter</span><span class="p">,</span>
                                                <span class="n">sigout</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;imp50&#39;</span><span class="p">),</span>
                                <span class="n">val_mapping</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ON&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;OFF&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                                <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;ON&#39;</span><span class="p">,</span> <span class="s1">&#39;OFF&#39;</span><span class="p">)</span> <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_ampdef&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigout</span><span class="p">),</span>
                               <span class="n">get_cmd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">set_cmd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">initial_value</span><span class="o">=</span><span class="s1">&#39;Vpk&#39;</span><span class="p">,</span>
                               <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Signal output amplitude&#39;s definition&quot;</span><span class="p">,</span>
                               <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                               <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;Vpk&#39;</span><span class="p">,</span> <span class="s1">&#39;Vrms&#39;</span><span class="p">,</span> <span class="s1">&#39;dBm&#39;</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_range&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigout</span><span class="p">),</span>
                                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Signal output range&#39;</span><span class="p">,</span>
                                <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sigout_setter</span><span class="p">,</span>
                                                <span class="n">sigout</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">),</span>
                                <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sigout_getter</span><span class="p">,</span>
                                                <span class="n">sigout</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;range&#39;</span><span class="p">),</span>
                                <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="mf">0.075</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_offset&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigout</span><span class="p">),</span>
                                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Signal output offset&#39;</span><span class="p">,</span>
                                <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sigout_setter</span><span class="p">,</span>
                                                <span class="n">sigout</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;offset&#39;</span><span class="p">),</span>
                                <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sigout_getter</span><span class="p">,</span>
                                                <span class="n">sigout</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;offset&#39;</span><span class="p">),</span>
                                <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span>
                                <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;V&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_autorange&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigout</span><span class="p">),</span>
                                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Enable signal output range.&#39;</span><span class="p">,</span>
                                <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sigout_setter</span><span class="p">,</span>
                                                <span class="n">sigout</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;autorange&#39;</span><span class="p">),</span>
                                <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sigout_getter</span><span class="p">,</span>
                                                <span class="n">sigout</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;autorange&#39;</span><span class="p">),</span>
                                <span class="n">val_mapping</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ON&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;OFF&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                                <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;ON&#39;</span><span class="p">,</span> <span class="s1">&#39;OFF&#39;</span><span class="p">)</span> <span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;MF&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">modeout</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span>
                        <span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_amplitude</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigout</span><span class="p">,</span> <span class="n">modeout</span><span class="p">),</span>
                        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Signal output amplitude&#39;</span><span class="p">,</span>
                        <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sigout_setter</span><span class="p">,</span>
                                        <span class="n">sigout</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;amplitudes&#39;</span><span class="p">,</span>
                                        <span class="n">output_mode</span><span class="o">=</span><span class="n">modeout</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sigout_getter</span><span class="p">,</span>
                                        <span class="n">sigout</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;amplitudes&#39;</span><span class="p">,</span>
                                        <span class="n">output_mode</span><span class="o">=</span><span class="n">modeout</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="n">docstring</span><span class="o">=</span><span class="s2">&quot;Set the signal output amplitude. The actual &quot;</span>
                                  <span class="s2">&quot;unit and representation is defined by &quot;</span>
                                  <span class="s2">&quot;signal_output</span><span class="si">{}</span><span class="s2">_ampdef &quot;</span>
                                  <span class="s2">&quot;parameter&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigout</span><span class="p">))</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span>
                        <span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_enable</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigout</span><span class="p">,</span> <span class="n">modeout</span><span class="p">),</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Output signal enabled/disabled.&quot;</span><span class="p">,</span>
                        <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sigout_setter</span><span class="p">,</span>
                                        <span class="n">sigout</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                        <span class="s1">&#39;enables&#39;</span><span class="p">,</span> <span class="n">output_mode</span><span class="o">=</span><span class="n">modeout</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sigout_getter</span><span class="p">,</span>
                                        <span class="n">sigout</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                        <span class="s1">&#39;enables&#39;</span><span class="p">,</span> <span class="n">output_mode</span><span class="o">=</span><span class="n">modeout</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="n">val_mapping</span><span class="o">=</span><span class="n">create_on_off_val_mapping</span><span class="p">(),</span>
                        <span class="n">docstring</span><span class="o">=</span><span class="s2">&quot;Enabling/Disabling the Signal Output. &quot;</span>
                                  <span class="s2">&quot;Corresponds to the blue LED indicator on &quot;</span>
                                  <span class="s2">&quot;the instrument front panel.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span>
                    <span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_enable&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigout</span><span class="p">),</span>
                    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Output signal enabled/disabled.&quot;</span><span class="p">,</span>
                    <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sigout_setter</span><span class="p">,</span>
                                    <span class="n">sigout</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                    <span class="n">outputampenable</span><span class="p">[</span><span class="n">sigout</span><span class="p">]),</span>
                    <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sigout_getter</span><span class="p">,</span>
                                    <span class="n">sigout</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                    <span class="n">outputampenable</span><span class="p">[</span><span class="n">sigout</span><span class="p">]),</span>
                    <span class="n">val_mapping</span><span class="o">=</span><span class="n">create_on_off_val_mapping</span><span class="p">(),</span>
                    <span class="n">docstring</span><span class="o">=</span><span class="s2">&quot;Enabling/Disabling the Signal Output. &quot;</span>
                              <span class="s2">&quot;Corresponds to the blue LED indicator on &quot;</span>
                              <span class="s2">&quot;the instrument front panel.&quot;</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span>
                    <span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_amplitude&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigout</span><span class="p">),</span>
                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Signal output amplitude&#39;</span><span class="p">,</span>
                    <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sigout_setter</span><span class="p">,</span>
                                    <span class="n">sigout</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="n">outputamps</span><span class="p">[</span><span class="n">sigout</span><span class="p">]),</span>
                    <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sigout_getter</span><span class="p">,</span>
                                    <span class="n">sigout</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="n">outputamps</span><span class="p">[</span><span class="n">sigout</span><span class="p">]),</span>
                    <span class="n">docstring</span><span class="o">=</span><span class="s2">&quot;Set the signal output amplitude. The actual unit&quot;</span>
                              <span class="s2">&quot; and representation is defined by &quot;</span>
                              <span class="s2">&quot;signal_output</span><span class="si">{}</span><span class="s2">_ampdef parameter&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sigout</span><span class="p">))</span>

        <span class="n">auxoutputchannels</span> <span class="o">=</span> <span class="n">ChannelList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;AUXOutputChannels&quot;</span><span class="p">,</span> <span class="n">AUXOutputChannel</span><span class="p">,</span>
                               <span class="n">snapshotable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">auxchannum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;aux_out</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">auxchannum</span><span class="p">)</span>
            <span class="n">auxchannel</span> <span class="o">=</span> <span class="n">AUXOutputChannel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">auxchannum</span><span class="p">)</span>
            <span class="n">auxoutputchannels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">auxchannel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_submodule</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">auxchannel</span><span class="p">)</span>
        <span class="n">auxoutputchannels</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_submodule</span><span class="p">(</span><span class="s1">&#39;aux_out_channels&#39;</span><span class="p">,</span> <span class="n">auxoutputchannels</span><span class="p">)</span>
        <span class="c1">########################################</span>
        <span class="c1"># SWEEPER PARAMETERS</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;sweeper_BWmode&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sweeper bandwidth control mode&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_setter</span><span class="p">,</span>
                                           <span class="s1">&#39;sweep/bandwidthcontrol&#39;</span><span class="p">),</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_getter</span><span class="p">,</span>
                                           <span class="s1">&#39;sweep/bandwidthcontrol&#39;</span><span class="p">),</span>
                           <span class="n">val_mapping</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;auto&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;fixed&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;current&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                           <span class="n">docstring</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                                     For each sweep point, the demodulator</span>
<span class="s2">                                     filter bandwidth (time constant) may</span>
<span class="s2">                                     be either set automatically, be the</span>
<span class="s2">                                     current demodulator bandwidth or be</span>
<span class="s2">                                     a fixed number; the sweeper_BW</span>
<span class="s2">                                     parameter.</span>
<span class="s2">                                     &quot;&quot;&quot;</span>
                           <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;sweeper_BW&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fixed bandwidth sweeper bandwidth (NEP)&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_setter</span><span class="p">,</span>
                                           <span class="s1">&#39;sweep/bandwidth&#39;</span><span class="p">),</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_getter</span><span class="p">,</span>
                                           <span class="s1">&#39;sweep/bandwidth&#39;</span><span class="p">),</span>
                           <span class="n">docstring</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                                     This is the NEP bandwidth used by the</span>
<span class="s2">                                     sweeper if sweeper_BWmode is set to</span>
<span class="s2">                                     &#39;fixed&#39;. If sweeper_BWmode is either</span>
<span class="s2">                                     &#39;auto&#39; or &#39;current&#39;, this value is</span>
<span class="s2">                                     ignored.</span>
<span class="s2">                                     &quot;&quot;&quot;</span>
                           <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;sweeper_start&#39;</span><span class="p">,</span>
                            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Start value of the sweep&#39;</span><span class="p">,</span>
                            <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_setter</span><span class="p">,</span>
                                            <span class="s1">&#39;sweep/start&#39;</span><span class="p">),</span>
                            <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_getter</span><span class="p">,</span>
                                            <span class="s1">&#39;sweep/start&#39;</span><span class="p">),</span>
                            <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">600e6</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;sweeper_stop&#39;</span><span class="p">,</span>
                            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Stop value of the sweep&#39;</span><span class="p">,</span>
                            <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_setter</span><span class="p">,</span>
                                            <span class="s1">&#39;sweep/stop&#39;</span><span class="p">),</span>
                            <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_getter</span><span class="p">,</span>
                                            <span class="s1">&#39;sweep/stop&#39;</span><span class="p">),</span>
                            <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">600e6</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;sweeper_samplecount&#39;</span><span class="p">,</span>
                            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Length of the sweep (pts)&#39;</span><span class="p">,</span>
                            <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_setter</span><span class="p">,</span>
                                            <span class="s1">&#39;sweep/samplecount&#39;</span><span class="p">),</span>
                            <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_getter</span><span class="p">,</span>
                                            <span class="s1">&#39;sweep/samplecount&#39;</span><span class="p">),</span>
                            <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Ints</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100000</span><span class="p">))</span>

        <span class="c1"># val_mapping for sweeper_param parameter</span>
        <span class="n">sweepparams</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Aux Out 1 Offset&#39;</span><span class="p">:</span> <span class="s1">&#39;auxouts/0/offset&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Aux Out 2 Offset&#39;</span><span class="p">:</span> <span class="s1">&#39;auxouts/1/offset&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Aux Out 3 Offset&#39;</span><span class="p">:</span> <span class="s1">&#39;auxouts/2/offset&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Aux Out 4 Offset&#39;</span><span class="p">:</span> <span class="s1">&#39;auxouts/3/offset&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Demod 1 Phase Shift&#39;</span><span class="p">:</span> <span class="s1">&#39;demods/0/phaseshift&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Demod 2 Phase Shift&#39;</span><span class="p">:</span> <span class="s1">&#39;demods/1/phaseshift&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Demod 3 Phase Shift&#39;</span><span class="p">:</span> <span class="s1">&#39;demods/2/phaseshift&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Demod 4 Phase Shift&#39;</span><span class="p">:</span> <span class="s1">&#39;demods/3/phaseshift&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Demod 5 Phase Shift&#39;</span><span class="p">:</span> <span class="s1">&#39;demods/4/phaseshift&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Demod 6 Phase Shift&#39;</span><span class="p">:</span> <span class="s1">&#39;demods/5/phaseshift&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Demod 7 Phase Shift&#39;</span><span class="p">:</span> <span class="s1">&#39;demods/6/phaseshift&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Demod 8 Phase Shift&#39;</span><span class="p">:</span> <span class="s1">&#39;demods/7/phaseshift&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Osc 1 Frequency&#39;</span><span class="p">:</span> <span class="s1">&#39;oscs/0/freq&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Osc 2 Frequency&#39;</span><span class="p">:</span> <span class="s1">&#39;oscs/1/freq&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Output 1 Amplitude 4&#39;</span><span class="p">:</span> <span class="s1">&#39;sigouts/0/amplitudes/3&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Output 1 Offset&#39;</span><span class="p">:</span> <span class="s1">&#39;sigouts/0/offset&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Output 2 Amplitude 8&#39;</span><span class="p">:</span> <span class="s1">&#39;sigouts/1/amplitudes/7&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Output 2 Offset&#39;</span><span class="p">:</span> <span class="s1">&#39;sigouts/1/offset&#39;</span>
                       <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;sweeper_param&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Parameter to sweep (sweep x-axis)&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_setter</span><span class="p">,</span>
                                           <span class="s1">&#39;sweep/gridnode&#39;</span><span class="p">),</span>
                           <span class="n">val_mapping</span><span class="o">=</span><span class="n">sweepparams</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_getter</span><span class="p">,</span>
                                           <span class="s1">&#39;sweep/gridnode&#39;</span><span class="p">),</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="n">sweepparams</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                           <span class="p">)</span>

        <span class="c1"># val_mapping for sweeper_units parameter</span>
        <span class="n">sweepunits</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Aux Out 1 Offset&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Aux Out 2 Offset&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Aux Out 3 Offset&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Aux Out 4 Offset&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 1 Phase Shift&#39;</span><span class="p">:</span> <span class="s1">&#39;degrees&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 2 Phase Shift&#39;</span><span class="p">:</span> <span class="s1">&#39;degrees&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 3 Phase Shift&#39;</span><span class="p">:</span> <span class="s1">&#39;degrees&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 4 Phase Shift&#39;</span><span class="p">:</span> <span class="s1">&#39;degrees&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 5 Phase Shift&#39;</span><span class="p">:</span> <span class="s1">&#39;degrees&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 6 Phase Shift&#39;</span><span class="p">:</span> <span class="s1">&#39;degrees&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 7 Phase Shift&#39;</span><span class="p">:</span> <span class="s1">&#39;degrees&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Demod 8 Phase Shift&#39;</span><span class="p">:</span> <span class="s1">&#39;degrees&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Osc 1 Frequency&#39;</span><span class="p">:</span> <span class="s1">&#39;Hz&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Osc 2 Frequency&#39;</span><span class="p">:</span> <span class="s1">&#39;Hz&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Output 1 Amplitude 4&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Output 1 Offset&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Output 2 Amplitude 8&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Output 2 Offset&#39;</span><span class="p">:</span> <span class="s1">&#39;V&#39;</span>
                      <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;sweeper_units&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Units of sweep x-axis&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeper_param</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
                           <span class="n">get_parser</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">sweepunits</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>

        <span class="c1"># val_mapping for sweeper_mode parameter</span>
        <span class="n">sweepmodes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Sequential&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="s1">&#39;Binary&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                      <span class="s1">&#39;Biderectional&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                      <span class="s1">&#39;Reverse&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;sweeper_mode&#39;</span><span class="p">,</span>
                            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sweep mode&#39;</span><span class="p">,</span>
                            <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_setter</span><span class="p">,</span>
                                            <span class="s1">&#39;sweep/scan&#39;</span><span class="p">),</span>
                            <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_getter</span><span class="p">,</span> <span class="s1">&#39;sweep/scan&#39;</span><span class="p">),</span>
                            <span class="n">val_mapping</span><span class="o">=</span><span class="n">sweepmodes</span><span class="p">,</span>
                            <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="n">sweepmodes</span><span class="p">))</span>
                            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;sweeper_order&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sweeper filter order&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_setter</span><span class="p">,</span>
                                           <span class="s1">&#39;sweep/order&#39;</span><span class="p">),</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_getter</span><span class="p">,</span>
                                           <span class="s1">&#39;sweep/order&#39;</span><span class="p">),</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Ints</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                           <span class="n">docstring</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                                     This value is invoked only when the</span>
<span class="s2">                                     sweeper_BWmode is set to &#39;fixed&#39;.</span>
<span class="s2">                                     &quot;&quot;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;sweeper_settlingtime&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Minimal settling time for the &#39;</span> <span class="o">+</span>
                                  <span class="s1">&#39;sweeper&#39;</span><span class="p">),</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_setter</span><span class="p">,</span>
                                           <span class="s1">&#39;sweep/settling/time&#39;</span><span class="p">),</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_getter</span><span class="p">,</span>
                                           <span class="s1">&#39;sweep/settling/time&#39;</span><span class="p">),</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span>
                           <span class="n">docstring</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                                     This is the minimal waiting time</span>
<span class="s2">                                     at each point during a sweep before the</span>
<span class="s2">                                     data acquisition starts. Note that the</span>
<span class="s2">                                     filter settings may result in a longer</span>
<span class="s2">                                     actual waiting/settling time.</span>
<span class="s2">                                     &quot;&quot;&quot;</span>
                           <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;sweeper_inaccuracy&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Demodulator filter settling inaccuracy&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_setter</span><span class="p">,</span>
                                           <span class="s1">&#39;sweep/settling/inaccuracy&#39;</span><span class="p">),</span>
                           <span class="n">docstring</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                                     Demodulator filter settling inaccuracy</span>
<span class="s2">                                     defining the wait time between a sweep</span>
<span class="s2">                                     parameter change and recording of the</span>
<span class="s2">                                     next sweep point. The settling time is</span>
<span class="s2">                                     calculated as the time required to attain</span>
<span class="s2">                                     the specified remaining proportion [1e-13,</span>
<span class="s2">                                     0.1] of an incoming step function. Typical</span>
<span class="s2">                                     inaccuracy values: 10m for highest sweep</span>
<span class="s2">                                     speed for large signals, 100u for precise</span>
<span class="s2">                                     amplitude measurements, 100n for precise</span>
<span class="s2">                                     noise measurements. Depending on the</span>
<span class="s2">                                     order of the demodulator filter the settling</span>
<span class="s2">                                     inaccuracy will define the number of filter</span>
<span class="s2">                                     time constants the sweeper has to wait. The</span>
<span class="s2">                                     maximum between this value and the settling</span>
<span class="s2">                                     time is taken as wait time until the next</span>
<span class="s2">                                     sweep point is recorded.</span>
<span class="s2">                                     &quot;&quot;&quot;</span>
                           <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;sweeper_settlingtc&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sweep filter settling time&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_getter</span><span class="p">,</span>
                                           <span class="s1">&#39;sweep/settling/tc&#39;</span><span class="p">),</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                           <span class="n">docstring</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;This settling time is in units of</span>
<span class="s2">                                        the filter time constant.&quot;&quot;&quot;</span>
                           <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;sweeper_averaging_samples&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Minimal no. of samples to average at &#39;</span> <span class="o">+</span>
                                  <span class="s1">&#39;each sweep point&#39;</span><span class="p">),</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_setter</span><span class="p">,</span>
                                           <span class="s1">&#39;sweep/averaging/sample&#39;</span><span class="p">),</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_getter</span><span class="p">,</span>
                                           <span class="s1">&#39;sweep/averaging/sample&#39;</span><span class="p">),</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Ints</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                           <span class="n">docstring</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                                     The actual number of samples is the</span>
<span class="s2">                                     maximum of this value and the</span>
<span class="s2">                                     sweeper_averaging_time times the</span>
<span class="s2">                                     relevant sample rate.</span>
<span class="s2">                                     &quot;&quot;&quot;</span>
                           <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;sweeper_averaging_time&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Minimal averaging time&#39;</span><span class="p">),</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_setter</span><span class="p">,</span>
                                           <span class="s1">&#39;sweep/averaging/tc&#39;</span><span class="p">),</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_getter</span><span class="p">,</span>
                                           <span class="s1">&#39;sweep/averaging/tc&#39;</span><span class="p">),</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span>
                           <span class="n">docstring</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                                     The actual number of samples is the</span>
<span class="s2">                                     maximum of this value times the</span>
<span class="s2">                                     relevant sample rate and the</span>
<span class="s2">                                     sweeper_averaging_samples.&quot;&quot;&quot;</span>
                           <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;sweeper_xmapping&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sweeper x mapping&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_setter</span><span class="p">,</span>
                                           <span class="s1">&#39;sweep/xmapping&#39;</span><span class="p">),</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sweep_getter</span><span class="p">,</span>
                                           <span class="s1">&#39;sweep/xmapping&#39;</span><span class="p">),</span>
                           <span class="n">val_mapping</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
                           <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;sweeper_sweeptime&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Expected sweep time&#39;</span><span class="p">,</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_sweep_time</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;sweeper_timeout&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sweep timeout&#39;</span><span class="p">,</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span>
                           <span class="n">initial_value</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">set_cmd</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1">########################################</span>
        <span class="c1"># THE SWEEP ITSELF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;Sweep&#39;</span><span class="p">,</span>
                           <span class="n">parameter_class</span><span class="o">=</span><span class="n">Sweep</span><span class="p">,</span>
                           <span class="p">)</span>

        <span class="c1"># A &quot;manual&quot; parameter: a list of the signals for the sweeper</span>
        <span class="c1"># to subscribe to</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sweeper_signals</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># type: List[str]</span>

        <span class="c1"># This is the dictionary keeping track of the sweeper settings</span>
        <span class="c1"># These are the default settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sweepdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="mf">1e6</span><span class="p">,</span>
                           <span class="s1">&#39;stop&#39;</span><span class="p">:</span> <span class="mf">10e6</span><span class="p">,</span>
                           <span class="s1">&#39;samplecount&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                           <span class="s1">&#39;bandwidthcontrol&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># fixed mode</span>
                           <span class="s1">&#39;bandwidth&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
                           <span class="s1">&#39;gridnode&#39;</span><span class="p">:</span> <span class="s1">&#39;oscs/0/freq&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;scan&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># sequential scan</span>
                           <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                           <span class="s1">&#39;settling/time&#39;</span><span class="p">:</span> <span class="mf">1e-6</span><span class="p">,</span>
                           <span class="s1">&#39;settling/inaccuracy&#39;</span><span class="p">:</span> <span class="mf">10e-3</span><span class="p">,</span>
                           <span class="s1">&#39;averaging/sample&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
                           <span class="s1">&#39;averaging/tc&#39;</span><span class="p">:</span> <span class="mf">100e-3</span><span class="p">,</span>
                           <span class="s1">&#39;xmapping&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># linear</span>
                          <span class="p">}</span>
        <span class="c1"># Set up the sweeper with the above settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Sweep</span><span class="o">.</span><span class="n">build_sweep</span><span class="p">()</span>

        <span class="c1">########################################</span>
        <span class="c1"># SCOPE PARAMETERS</span>
        <span class="c1"># default parameters:</span>

        <span class="c1"># This parameter corresponds to the Run/Stop button in the GUI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_runstop&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Scope run state&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                           <span class="s1">&#39;enable&#39;</span><span class="p">),</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                           <span class="s1">&#39;enable&#39;</span><span class="p">),</span>
                           <span class="n">val_mapping</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;run&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;run&#39;</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span><span class="p">),</span>
                           <span class="n">docstring</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;This parameter corresponds to the &#39;</span>
                                      <span class="s1">&#39;run/stop button in the GUI.&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_mode&#39;</span><span class="p">,</span>
                            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Scope&#39;s mode: time or frequency domain.&quot;</span><span class="p">,</span>
                            <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_setter</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="s1">&#39;mode&#39;</span><span class="p">),</span>
                            <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_getter</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">),</span>
                            <span class="n">val_mapping</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Time Domain&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                         <span class="s1">&#39;Freq Domain FFT&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span>
                            <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;Time Domain&#39;</span><span class="p">,</span> <span class="s1">&#39;Freq Domain FFT&#39;</span><span class="p">)</span>
                            <span class="p">)</span>

        <span class="c1"># 1: Channel 1 on, Channel 2 off.</span>
        <span class="c1"># 2: Channel 1 off, Channel 2 on,</span>
        <span class="c1"># 3: Channel 1 on, Channel 2 on.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_channels&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Recorded scope channels&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_setter</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                           <span class="s1">&#39;channel&#39;</span><span class="p">),</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                           <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;channel&#39;</span><span class="p">),</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                           <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_samplingrate_codes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;1.80 GHz&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                                   <span class="s1">&#39;900 MHz&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                   <span class="s1">&#39;450 MHz&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                                   <span class="s1">&#39;225 MHz&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                                   <span class="s1">&#39;113 MHz&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                                   <span class="s1">&#39;56.2 MHz&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                                   <span class="s1">&#39;28.1 MHz&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
                                   <span class="s1">&#39;14.0 MHz&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                                   <span class="s1">&#39;7.03 MHz&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                                   <span class="s1">&#39;3.50 MHz&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
                                   <span class="s1">&#39;1.75 MHz&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                                   <span class="s1">&#39;880 kHz&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
                                   <span class="s1">&#39;440 kHz&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
                                   <span class="s1">&#39;220 kHz&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
                                   <span class="s1">&#39;110 kHz&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                                   <span class="s1">&#39;54.9 kHz&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
                                   <span class="s1">&#39;27.5 kHz&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_samplingrate&#39;</span><span class="p">,</span>
                            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Scope&#39;s sampling rate&quot;</span><span class="p">,</span>
                            <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_setter</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="s1">&#39;time&#39;</span><span class="p">),</span>
                            <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">),</span>
                            <span class="n">val_mapping</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_samplingrate_codes</span><span class="p">,</span>
                            <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_samplingrate_codes</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_samplingrate_float&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Scope&#39;s sampling rate as float&quot;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_samplingrate_as_float</span><span class="p">,</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_samplingrate_as_float</span><span class="p">,</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="mf">1.8e9</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">_samplingrate_codes</span><span class="o">.</span><span class="n">values</span><span class="p">()]),</span>
                           <span class="n">docstring</span><span class="o">=</span><span class="s2">&quot;&quot;&quot; A numeric representation of the scope&#39;s</span>
<span class="s2">                             samplingrate parameter. Sets and gets the sampling </span>
<span class="s2">                             rate by using the scope_samplingrate parameter.&quot;&quot;&quot;</span>
                           <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_length&#39;</span><span class="p">,</span>
                            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Length of scope trace (pts)&quot;</span><span class="p">,</span>
                            <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_setter</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                            <span class="s1">&#39;length&#39;</span><span class="p">),</span>
                            <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;length&#39;</span><span class="p">),</span>
                            <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="mi">4096</span><span class="p">,</span> <span class="mi">128000000</span><span class="p">),</span>
                            <span class="n">get_parser</span><span class="o">=</span><span class="nb">int</span>
                            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_duration&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Scope trace duration&quot;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_setter</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                           <span class="s1">&#39;duration&#39;</span><span class="p">),</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_getter</span><span class="p">,</span>
                                           <span class="s1">&#39;duration&#39;</span><span class="p">),</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="mf">2.27e-6</span><span class="p">,</span><span class="mf">4.660e3</span><span class="p">),</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span>
                           <span class="p">)</span>

        <span class="c1"># Map the possible input sources to LabOne&#39;s IDs.</span>
        <span class="c1"># The IDs can be seen in log file of LabOne UI</span>
        <span class="n">inputselect</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Signal Input 1&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                       <span class="s1">&#39;Signal Input 2&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                       <span class="s1">&#39;Trig Input 1&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                       <span class="s1">&#39;Trig Input 2&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                       <span class="s1">&#39;Aux Output 1&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                       <span class="s1">&#39;Aux Output 2&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                       <span class="s1">&#39;Aux Output 3&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
                       <span class="s1">&#39;Aux Output 4&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                       <span class="s1">&#39;Aux In 1 Ch 1&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                       <span class="s1">&#39;Aux In 1 Ch 2&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
                       <span class="s1">&#39;Osc phi Demod 4&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                       <span class="s1">&#39;Osc phi Demod 8&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
                       <span class="s1">&#39;AU Cartesian 1&#39;</span><span class="p">:</span> <span class="mi">112</span><span class="p">,</span>
                       <span class="s1">&#39;AU Cartesian 2&#39;</span><span class="p">:</span> <span class="mi">113</span><span class="p">,</span>
                       <span class="s1">&#39;AU Polar 1&#39;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
                       <span class="s1">&#39;AU Polar 2&#39;</span><span class="p">:</span> <span class="mi">129</span><span class="p">,</span>
                       <span class="p">}</span>
        <span class="c1"># Add all 8 demodulators and their respective parameters</span>
        <span class="c1"># to inputselect as well.</span>
        <span class="c1"># Numbers correspond to LabOne IDs, taken from UI log.</span>
        <span class="k">for</span> <span class="n">demod</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">):</span>
            <span class="n">inputselect</span><span class="p">[</span><span class="s1">&#39;Demod </span><span class="si">{}</span><span class="s1"> X&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">demod</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">15</span><span class="o">+</span><span class="n">demod</span>
            <span class="n">inputselect</span><span class="p">[</span><span class="s1">&#39;Demod </span><span class="si">{}</span><span class="s1"> Y&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">demod</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">31</span><span class="o">+</span><span class="n">demod</span>
            <span class="n">inputselect</span><span class="p">[</span><span class="s1">&#39;Demod </span><span class="si">{}</span><span class="s1"> R&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">demod</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">47</span><span class="o">+</span><span class="n">demod</span>
            <span class="n">inputselect</span><span class="p">[</span><span class="s1">&#39;Demod </span><span class="si">{}</span><span class="s1"> Phase&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">demod</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">63</span><span class="o">+</span><span class="n">demod</span>

        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_channel</span><span class="si">{}</span><span class="s1">_input&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">),</span>
                            <span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Scope&#39;s channel </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span> <span class="o">+</span>
                                   <span class="s2">&quot; input source&quot;</span><span class="p">),</span>
                            <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_setter</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="p">(</span><span class="s1">&#39;channels/</span><span class="si">{}</span><span class="s1">/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span>
                                             <span class="s1">&#39;inputselect&#39;</span><span class="p">)),</span>
                            <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="p">(</span><span class="s1">&#39;channels/</span><span class="si">{}</span><span class="s1">/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span>
                                             <span class="s1">&#39;inputselect&#39;</span><span class="p">)),</span>
                            <span class="n">val_mapping</span><span class="o">=</span><span class="n">inputselect</span><span class="p">,</span>
                            <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="n">inputselect</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_average_weight&#39;</span><span class="p">,</span>
                            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Scope Averages&quot;</span><span class="p">,</span>
                            <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_setter</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="s1">&#39;averager/weight&#39;</span><span class="p">),</span>
                            <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_getter</span><span class="p">,</span>
                                            <span class="s1">&#39;averager/weight&#39;</span><span class="p">),</span>
                            <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_trig_enable&#39;</span><span class="p">,</span>
                            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Enable triggering for scope readout&quot;</span><span class="p">,</span>
                            <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;trigenable&#39;</span><span class="p">),</span>
                            <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;trigenable&#39;</span><span class="p">),</span>
                            <span class="n">val_mapping</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ON&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;OFF&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                            <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;ON&#39;</span><span class="p">,</span> <span class="s1">&#39;OFF&#39;</span><span class="p">)</span>
                            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_trig_signal&#39;</span><span class="p">,</span>
                            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Trigger signal source&quot;</span><span class="p">,</span>
                            <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;trigchannel&#39;</span><span class="p">),</span>
                            <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;trigchannel&#39;</span><span class="p">),</span>
                            <span class="n">val_mapping</span><span class="o">=</span><span class="n">inputselect</span><span class="p">,</span>
                            <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="n">inputselect</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                            <span class="p">)</span>

        <span class="n">slopes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;None&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Rise&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Fall&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Both&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_trig_slope&#39;</span><span class="p">,</span>
                            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Scope&#39;s triggering slope&quot;</span><span class="p">,</span>
                            <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;trigslope&#39;</span><span class="p">),</span>
                            <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;trigslope&#39;</span><span class="p">),</span>
                            <span class="n">val_mapping</span><span class="o">=</span><span class="n">slopes</span><span class="p">,</span>
                            <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="n">slopes</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                            <span class="p">)</span>

        <span class="c1"># TODO: figure out how value/percent works for the trigger level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_trig_level&#39;</span><span class="p">,</span>
                            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Scope trigger level&quot;</span><span class="p">,</span>
                            <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;triglevel&#39;</span><span class="p">),</span>
                            <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;triglevel&#39;</span><span class="p">),</span>
                            <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">()</span>
                            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_trig_hystmode&#39;</span><span class="p">,</span>
                            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Enable triggering for scope readout.&quot;</span><span class="p">,</span>
                            <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;trighysteresis/mode&#39;</span><span class="p">),</span>
                            <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;trighysteresis/mode&#39;</span><span class="p">),</span>
                            <span class="n">val_mapping</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;absolute&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;relative&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                            <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;absolute&#39;</span><span class="p">,</span> <span class="s1">&#39;relative&#39;</span><span class="p">)</span>
                            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_trig_hystrelative&#39;</span><span class="p">,</span>
                            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Trigger hysteresis, relative value in %&quot;</span><span class="p">,</span>
                            <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;trighysteresis/relative&#39;</span><span class="p">),</span>
                            <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;trighysteresis/relative&#39;</span><span class="p">),</span>
                            <span class="c1"># val_mapping= lambda x: 0.01*x,</span>
                            <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_trig_hystabsolute&#39;</span><span class="p">,</span>
                            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Trigger hysteresis, absolute value&quot;</span><span class="p">,</span>
                            <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;trighysteresis/absolute&#39;</span><span class="p">),</span>
                            <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;trighysteresis/absolute&#39;</span><span class="p">),</span>
                            <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
                            <span class="p">)</span>

        <span class="n">triggates</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Trigger In 3 High&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Trigger In 3 Low&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="s1">&#39;Trigger In 4 High&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Trigger In 4 Low&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_trig_gating_source&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Scope trigger gating source&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                           <span class="s1">&#39;triggate/inputselect&#39;</span><span class="p">),</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                           <span class="s1">&#39;triggate/inputselect&#39;</span><span class="p">),</span>
                           <span class="n">val_mapping</span><span class="o">=</span><span class="n">triggates</span><span class="p">,</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="n">triggates</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                           <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_trig_gating_enable&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Scope trigger gating ON/OFF&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                           <span class="s1">&#39;triggate/enable&#39;</span><span class="p">),</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                           <span class="s1">&#39;triggate/enable&#39;</span><span class="p">),</span>
                           <span class="n">val_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ON&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;OFF&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;ON&#39;</span><span class="p">,</span> <span class="s1">&#39;OFF&#39;</span><span class="p">))</span>

        <span class="c1"># make this a slave parameter off scope_holdoff_seconds</span>
        <span class="c1"># and scope_holdoff_events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_trig_holdoffmode&#39;</span><span class="p">,</span>
                            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Scope trigger holdoff mode&quot;</span><span class="p">,</span>
                            <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;trigholdoffmode&#39;</span><span class="p">),</span>
                            <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;trigholdoffmode&#39;</span><span class="p">),</span>
                            <span class="n">val_mapping</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;events&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                            <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;events&#39;</span><span class="p">)</span>
                            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_trig_holdoffseconds&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Scope trigger holdoff&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_setter</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                           <span class="s1">&#39;trigholdoff&#39;</span><span class="p">),</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                           <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;trigholdoff&#39;</span><span class="p">),</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="mf">20e-6</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
                           <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_trig_reference&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Scope trigger reference&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_setter</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                           <span class="s1">&#39;trigreference&#39;</span><span class="p">),</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                           <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;trigreference&#39;</span><span class="p">),</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Numbers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                           <span class="p">)</span>

        <span class="c1"># TODO: add validation. What&#39;s the minimal/maximal delay?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_trig_delay&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Scope trigger delay&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_setter</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                           <span class="s1">&#39;trigdelay&#39;</span><span class="p">),</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                           <span class="s1">&#39;trigdelay&#39;</span><span class="p">),</span>
                           <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_segments&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Enable/disable segments&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scope_setter</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                           <span class="s1">&#39;segments/enable&#39;</span><span class="p">),</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                           <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;segments/enable&#39;</span><span class="p">),</span>
                           <span class="n">val_mapping</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;OFF&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ON&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Enum</span><span class="p">(</span><span class="s1">&#39;ON&#39;</span><span class="p">,</span> <span class="s1">&#39;OFF&#39;</span><span class="p">)</span>
                           <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;scope_segments_count&#39;</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;No. of segments returned by scope&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                           <span class="s1">&#39;segments/count&#39;</span><span class="p">),</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">,</span> <span class="s1">&#39;scopes&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                          <span class="s1">&#39;segments/count&#39;</span><span class="p">),</span>
                           <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="o">.</span><span class="n">Ints</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32768</span><span class="p">),</span>
                           <span class="n">get_parser</span><span class="o">=</span><span class="nb">int</span>
                           <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_function</span><span class="p">(</span><span class="s1">&#39;scope_reset_avg&#39;</span><span class="p">,</span>
                            <span class="n">call_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">set</span><span class="p">,</span>
                                             <span class="s1">&#39;scopeModule/averager/restart&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                            <span class="p">)</span>

        <span class="c1">########################################</span>
        <span class="c1"># THE SCOPE ITSELF</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;Scope&#39;</span><span class="p">,</span>
                           <span class="n">parameter_class</span><span class="o">=</span><span class="n">Scope</span><span class="p">,</span>
                           <span class="p">)</span>

        <span class="c1">########################################</span>
        <span class="c1"># SYSTEM PARAMETERS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;external_clock_enabled&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">setInt</span><span class="p">,</span>
                                           <span class="n">f</span><span class="s2">&quot;/</span><span class="si">{self.device}</span><span class="s2">/system/extclk&quot;</span><span class="p">),</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">getInt</span><span class="p">,</span>
                                           <span class="n">f</span><span class="s2">&quot;/</span><span class="si">{self.device}</span><span class="s2">/system/extclk&quot;</span><span class="p">),</span>
                           <span class="n">val_mapping</span><span class="o">=</span><span class="n">create_on_off_val_mapping</span><span class="p">(),</span>
                           <span class="n">docstring</span><span class="o">=</span><span class="s2">&quot;Set the clock source to external 10 MHz reference clock.&quot;</span>
                           <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s1">&#39;jumbo_frames_enabled&#39;</span><span class="p">,</span>
                           <span class="n">set_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">setInt</span><span class="p">,</span>
                                           <span class="n">f</span><span class="s2">&quot;/</span><span class="si">{self.device}</span><span class="s2">/system/jumbo&quot;</span><span class="p">),</span>
                           <span class="n">get_cmd</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">getInt</span><span class="p">,</span>
                                           <span class="n">f</span><span class="s2">&quot;/</span><span class="si">{self.device}</span><span class="s2">/system/jumbo&quot;</span><span class="p">),</span>
                           <span class="n">val_mapping</span><span class="o">=</span><span class="n">create_on_off_val_mapping</span><span class="p">(),</span>
                           <span class="n">docstring</span><span class="o">=</span><span class="s2">&quot;Enable jumbo frames on the TCP/IP interface&quot;</span>
                           <span class="p">)</span>

<div class="viewcode-block" id="ZIUHFLI.snapshot_base"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.ZI.html#qcodes.instrument_drivers.ZI.ZIUHFLI.ZIUHFLI.snapshot_base">[docs]</a>    <span class="k">def</span> <span class="nf">snapshot_base</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                      <span class="n">params_to_skip_update</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
                      <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Override the base method to ignore &#39;sweeper_sweeptime&#39; if no signals selected.&quot;&quot;&quot;</span>
        <span class="n">params_to_skip</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sweeper_signals</span><span class="p">:</span>
            <span class="n">params_to_skip</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;sweeper_sweeptime&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">params_to_skip_update</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params_to_skip</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">params_to_skip_update</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">ZIUHFLI</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">snapshot_base</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="n">update</span><span class="p">,</span>
                                                   <span class="n">params_to_skip_update</span><span class="o">=</span><span class="n">params_to_skip</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_setter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">setting</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        General function to set/send settings to the device.</span>

<span class="sd">        The module (e.g demodulator, input, output,..) number is counted in a</span>
<span class="sd">        zero indexed fashion.</span>

<span class="sd">        Args:</span>
<span class="sd">            module (str): The module (eg. demodulator, input, output, ..)</span>
<span class="sd">                to set.</span>
<span class="sd">            number (int): Module&#39;s index</span>
<span class="sd">            mode (int): Indicating whether we are asking for an int (0) or double (1)</span>
<span class="sd">            setting (str): The module&#39;s setting to set.</span>
<span class="sd">            value (int/double): The value to set.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">setstr</span> <span class="o">=</span> <span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">setting</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">setInt</span><span class="p">(</span><span class="n">setstr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">setDouble</span><span class="p">(</span><span class="n">setstr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">mode</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">setting</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        General get function for generic parameters. Note that some parameters</span>
<span class="sd">        use more specialised setter/getters.</span>

<span class="sd">        The module (e.g demodulator, input, output,..) number is counted in a</span>
<span class="sd">        zero indexed fashion.</span>

<span class="sd">        Args:</span>
<span class="sd">            module (str): The module (eg. demodulator, input, output, ..)</span>
<span class="sd">                we want to know the value of.</span>
<span class="sd">            number (int): Module&#39;s index</span>
<span class="sd">            mode (int): Indicating whether we are asking for an int or double.</span>
<span class="sd">                0: Int, 1: double, 2: Sample</span>
<span class="sd">            setting (str): The module&#39;s setting to set.</span>
<span class="sd">        returns:</span>
<span class="sd">            inquered value</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">querystr</span> <span class="o">=</span> <span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">setting</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;getting </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">querystr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="n">querystr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">getDouble</span><span class="p">(</span><span class="n">querystr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">getSample</span><span class="p">(</span><span class="n">querystr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Invalid mode supplied&quot;</span><span class="p">)</span>
        <span class="c1"># Weird exception, samplingrate returns a string</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_get_demod_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">demod_param</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;getting demod </span><span class="si">%s</span><span class="s2"> param </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">demod_param</span><span class="p">)</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">module</span> <span class="o">=</span> <span class="s1">&#39;demods&#39;</span>
        <span class="n">setting</span> <span class="o">=</span> <span class="s1">&#39;sample&#39;</span>
        <span class="k">if</span> <span class="n">demod_param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;phi&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Invalid demodulator parameter&quot;</span><span class="p">)</span>
        <span class="n">datadict</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">setting</span><span class="p">))</span>
        <span class="n">datadict</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">datadict</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">datadict</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
        <span class="n">datadict</span><span class="p">[</span><span class="s1">&#39;phi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">datadict</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">datadict</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">deg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">datadict</span><span class="p">[</span><span class="n">demod_param</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_sigout_setter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                       <span class="n">mode</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                       <span class="n">setting</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                       <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
                       <span class="n">output_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to set signal output&#39;s settings. A specific setter function is</span>
<span class="sd">        needed as parameters depend on each other and need to be checked and</span>
<span class="sd">        updated accordingly.</span>

<span class="sd">        Args:</span>
<span class="sd">            number: The output channel to use. Either 1 or 2.</span>
<span class="sd">            mode: Indicating whether we are asking for an int (0) or double (1).</span>
<span class="sd">            setting: The module&#39;s setting to set.</span>
<span class="sd">            value: The value to set the setting to.</span>
<span class="sd">            output_mode: Some options may take an extra int to indicate which of the 8</span>
<span class="sd">                         demodulators this acts on</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># convenient reference</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

        <span class="n">amp_val_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Vpk&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                        <span class="s1">&#39;Vrms&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="n">value</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                        <span class="s1">&#39;dBm&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">((</span><span class="n">value</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
                        <span class="p">}</span>

        <span class="k">def</span> <span class="nf">amp_valid</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="n">ampdef_val</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_ampdef&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">autorange_val</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_autorange&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">autorange_val</span> <span class="o">==</span> <span class="s1">&#39;ON&#39;</span><span class="p">:</span>
                <span class="n">imp50_val</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_imp50&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                <span class="n">imp50_dic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;OFF&#39;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span> <span class="s1">&#39;ON&#39;</span><span class="p">:</span> <span class="mf">0.75</span><span class="p">}</span>
                <span class="n">range_val</span> <span class="o">=</span> <span class="n">imp50_dic</span><span class="p">[</span><span class="n">imp50_val</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">so_range</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_range&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                <span class="n">range_val</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">so_range</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

            <span class="n">converter</span> <span class="o">=</span> <span class="n">amp_val_dict</span><span class="p">[</span><span class="n">ampdef_val</span><span class="p">]</span>
            <span class="k">if</span> <span class="o">-</span><span class="n">range_val</span> <span class="o">&lt;</span> <span class="n">amp_val_dict</span><span class="p">[</span><span class="n">ampdef_val</span><span class="p">](</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">range_val</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Signal Output:&#39;</span>
                                 <span class="o">+</span> <span class="s1">&#39; Amplitude </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> too high for chosen range.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">,</span>
                                                                                        <span class="n">converter</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>

        <span class="k">def</span> <span class="nf">offset_valid</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

            <span class="k">def</span> <span class="nf">validate_against_individual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">amp_val</span><span class="p">,</span> <span class="n">range_val</span><span class="p">):</span>
                <span class="n">amp_val</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">amp_val</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="k">if</span> <span class="o">-</span><span class="n">range_val</span> <span class="o">&lt;</span> <span class="n">value</span> <span class="o">+</span> <span class="n">amp_val</span> <span class="o">&gt;</span> <span class="n">range_val</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Signal Output: Offset too high for &#39;</span>
                                     <span class="s1">&#39;chosen range.&#39;</span><span class="p">)</span>

            <span class="n">range_val</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_range&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">range_val</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">range_val</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;MF&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span>
                    <span class="n">amp_val</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_amplitude</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                    <span class="n">validate_against_individual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">amp_val</span><span class="p">,</span> <span class="n">range_val</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">amp_val</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_amplitude&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                <span class="n">validate_against_individual</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">amp_val</span><span class="p">,</span> <span class="n">range_val</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">range_valid</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="n">autorange_val</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_autorange&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">imp50_val</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_imp50&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">imp50_dic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;OFF&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">],</span> <span class="s1">&#39;ON&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]}</span>

            <span class="k">if</span> <span class="n">autorange_val</span> <span class="o">==</span> <span class="s2">&quot;ON&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Signal Output :&#39;</span>
                                <span class="s1">&#39; Cannot set range as autorange is turned on.&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">imp50_dic</span><span class="p">[</span><span class="n">imp50_val</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Signal Output: Choose a valid range:&#39;</span>
                                 <span class="s1">&#39;[0.75, 0.075] if imp50 is on, [1.5, 0.15]&#39;</span>
                                 <span class="s1">&#39; otherwise.&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">ampdef_valid</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="c1"># check which amplitude definition you can use.</span>
            <span class="c1"># dBm is only possible with 50 Ohm imp ON</span>
            <span class="n">imp50_val</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_imp50&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">imp50_ampdef_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ON&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Vpk&#39;</span><span class="p">,</span><span class="s1">&#39;Vrms&#39;</span><span class="p">,</span> <span class="s1">&#39;dBm&#39;</span><span class="p">],</span>
                                 <span class="s1">&#39;OFF&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Vpk&#39;</span><span class="p">,</span><span class="s1">&#39;Vrms&#39;</span><span class="p">]}</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">imp50_ampdef_dict</span><span class="p">[</span><span class="n">imp50_val</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Signal Output: Choose a valid amplitude &quot;</span>
                                 <span class="s2">&quot;definition; [&#39;Vpk&#39;,&#39;Vrms&#39;, &#39;dBm&#39;] if imp50 is&quot;</span>
                                 <span class="s2">&quot; on, [&#39;Vpk&#39;,&#39;Vrms&#39;] otherwise.&quot;</span><span class="p">)</span>

        <span class="n">dynamic_validation</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="n">range_valid</span><span class="p">,</span>
                              <span class="s1">&#39;ampdef&#39;</span><span class="p">:</span> <span class="n">ampdef_valid</span><span class="p">,</span>
                              <span class="s1">&#39;amplitudes&#39;</span><span class="p">:</span> <span class="n">amp_valid</span><span class="p">,</span>
                              <span class="s1">&#39;offset&#39;</span><span class="p">:</span> <span class="n">offset_valid</span><span class="p">}</span>

        <span class="k">def</span> <span class="nf">update_range_offset_amp</span><span class="p">():</span>
            <span class="n">range_val</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_range&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">offset_val</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_offset&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">if</span> <span class="s1">&#39;MF&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">]:</span>
                <span class="n">amps_val</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_amplitude</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">output</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">amps_val</span> <span class="o">=</span> <span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_amplitude&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">()]</span>
            <span class="k">for</span> <span class="n">amp_val</span> <span class="ow">in</span> <span class="n">amps_val</span><span class="p">:</span>
                <span class="k">if</span> <span class="o">-</span><span class="n">range_val</span> <span class="o">&lt;</span> <span class="n">offset_val</span> <span class="o">+</span> <span class="n">amp_val</span> <span class="o">&gt;</span> <span class="n">range_val</span><span class="p">:</span>
                    <span class="c1"># The GUI would allow higher values but it would clip the signal.</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Signal Output: Amplitude and/or &#39;</span>
                                     <span class="s1">&#39;offset out of range.&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">update_offset</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_offset&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">update_amp</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;MF&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;options&#39;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_amplitude</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_amplitude&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">update_range</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;signal_output</span><span class="si">{}</span><span class="s1">_autorange&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="c1"># parameters which will potentially change other parameters</span>
        <span class="n">changing_param</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;imp50&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">update_range_offset_amp</span><span class="p">,</span> <span class="n">update_range</span><span class="p">],</span>
                          <span class="s1">&#39;autorange&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">update_range</span><span class="p">],</span>
                          <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">update_offset</span><span class="p">,</span> <span class="n">update_amp</span><span class="p">],</span>
                          <span class="s1">&#39;amplitudes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">update_range</span><span class="p">,</span> <span class="n">update_amp</span><span class="p">],</span>
                          <span class="s1">&#39;offset&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">update_range</span><span class="p">]</span>
                         <span class="p">}</span>

        <span class="n">setstr</span> <span class="o">=</span> <span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">/sigouts/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">setting</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">setstr</span> <span class="o">+=</span> <span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_mode</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">setting</span> <span class="ow">in</span> <span class="n">dynamic_validation</span><span class="p">:</span>
            <span class="n">dynamic_validation</span><span class="p">[</span><span class="n">setting</span><span class="p">](</span><span class="n">number</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">setInt</span><span class="p">(</span><span class="n">setstr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">setDouble</span><span class="p">(</span><span class="n">setstr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Invalid mode supplied&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">setting</span> <span class="ow">in</span> <span class="n">changing_param</span><span class="p">:</span>
            <span class="p">[</span><span class="n">f</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">changing_param</span><span class="p">[</span><span class="n">setting</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">_sigout_getter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">setting</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                       <span class="n">output_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to query the settings of signal outputs. Specific setter</span>
<span class="sd">        function is needed as parameters depend on each other and need to be</span>
<span class="sd">        checked and updated accordingly.</span>

<span class="sd">        Args:</span>
<span class="sd">            number:</span>
<span class="sd">            mode: Indicating whether we are asking for an int (0) or double (1).</span>
<span class="sd">            setting: The module&#39;s setting to set.</span>
<span class="sd">            output_mode: Some options may take an extra int to indicate which</span>
<span class="sd">            of the 8 demodulators this acts on</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">querystr</span> <span class="o">=</span> <span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">/sigouts/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">setting</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">querystr</span> <span class="o">+=</span> <span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_mode</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="n">querystr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">getDouble</span><span class="p">(</span><span class="n">querystr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Invalid mode supplied&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_list_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list with all nodes in the sub-tree below the specified node.</span>

<span class="sd">        Args:</span>
<span class="sd">            node (str): Module of which you want to know the parameters.</span>
<span class="sd">        return:</span>
<span class="sd">            list of sub-nodes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">getList</span><span class="p">(</span><span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">node</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">node_list</span>

<div class="viewcode-block" id="ZIUHFLI.NEPBW_to_timeconstant"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.ZI.html#qcodes.instrument_drivers.ZI.ZIUHFLI.ZIUHFLI.NEPBW_to_timeconstant">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">NEPBW_to_timeconstant</span><span class="p">(</span><span class="n">NEPBW</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function to translate a NEP BW and a filter order</span>
<span class="sd">        to a filter time constant. Meant to be used when calculating</span>
<span class="sd">        sweeper sweep times.</span>

<span class="sd">        Note: precise only to within a few percent.</span>

<span class="sd">        Args:</span>
<span class="sd">            NEPBW (float): The NEP bandwidth in Hz</span>
<span class="sd">            order (int): The filter order</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The filter time constant in s.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">const</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mf">0.249</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mf">0.124</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mf">0.093</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mf">0.078</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mf">0.068</span><span class="p">,</span>
                 <span class="mi">6</span><span class="p">:</span> <span class="mf">0.061</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="mf">0.056</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span> <span class="mf">0.052</span><span class="p">}</span>
        <span class="n">tau_c</span> <span class="o">=</span> <span class="n">const</span><span class="p">[</span><span class="n">order</span><span class="p">]</span><span class="o">/</span><span class="n">NEPBW</span>

        <span class="k">return</span> <span class="n">tau_c</span></div>

    <span class="k">def</span> <span class="nf">_get_sweep_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get_cmd for the sweeper_sweeptime parameter.</span>

<span class="sd">        Note: this calculation is only an estimate and not precise to more</span>
<span class="sd">        than a few percent.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[float, None]: None if the bandwidthcontrol setting is</span>
<span class="sd">              &#39;auto&#39; (then all bets are off), otherwise a time in seconds.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: if no signals are added to the sweep</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Possible TODO: cut down on the number of instrument</span>
        <span class="c1"># queries.</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sweeper_signals</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No signals selected! Can not find sweep time.&#39;</span><span class="p">)</span>

        <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweeper_BWmode</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

        <span class="c1"># The effective time constant of the demodulator depends on the</span>
        <span class="c1"># sweeper/bandwidthcontrol setting.</span>
        <span class="c1">#</span>
        <span class="c1"># If this setting is &#39;current&#39;, the largest current</span>
        <span class="c1"># time constant of the involved demodulators is used</span>
        <span class="c1">#</span>
        <span class="c1"># If the setting is &#39;fixed&#39;, the NEP BW specified under</span>
        <span class="c1"># sweep/bandwidth is used. The filter order is needed to convert</span>
        <span class="c1"># the NEP BW to a time constant</span>

        <span class="n">demods</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">sig</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">sig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sweeper_signals</span><span class="p">])</span>
        <span class="n">rates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">demod</span> <span class="ow">in</span> <span class="n">demods</span><span class="p">:</span>
            <span class="n">rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">(</span><span class="s1">&#39;demods&#39;</span><span class="p">,</span> <span class="n">demod</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">))</span>
        <span class="n">rate</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">rates</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;current&#39;</span><span class="p">:</span>
            <span class="n">tcs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">demod</span> <span class="ow">in</span> <span class="n">demods</span><span class="p">:</span>
                <span class="n">tcs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getter</span><span class="p">(</span><span class="s1">&#39;demods&#39;</span><span class="p">,</span> <span class="n">demod</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;timeconstant&#39;</span><span class="p">))</span>

            <span class="n">tau_c</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">tcs</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;fixed&#39;</span><span class="p">:</span>
            <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweeper_order</span><span class="p">()</span>
            <span class="n">BW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweeper_BW</span><span class="p">()</span>

            <span class="n">tau_c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NEPBW_to_timeconstant</span><span class="p">(</span><span class="n">BW</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">settlingtime</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeper_settlingtc</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">*</span><span class="n">tau_c</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">sweeper_settlingtime</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="n">averagingtime</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeper_averaging_time</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">*</span><span class="n">tau_c</span><span class="o">*</span><span class="n">rate</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">sweeper_averaging_samples</span><span class="o">.</span><span class="n">get</span><span class="p">())</span><span class="o">/</span><span class="n">rate</span>

        <span class="n">time_est</span> <span class="o">=</span> <span class="p">(</span><span class="n">settlingtime</span><span class="o">+</span><span class="n">averagingtime</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeper_samplecount</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">time_est</span>

    <span class="k">def</span> <span class="nf">_sweep_setter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setting</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set_cmd for all sweeper parameters. The value and setting are saved in</span>
<span class="sd">        a dictionary which is read by the Sweep parameter&#39;s build_sweep method</span>
<span class="sd">        and only then sent to the instrument.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">setting</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sweepdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep_correctly_built</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_sweep_getter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setting</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        General get_cmd for sweeper parameters</span>

<span class="sd">        The built-in sweeper.get command returns a dictionary, but we want</span>
<span class="sd">        single values.</span>

<span class="sd">        Args:</span>
<span class="sd">            setting (str): the path used by ZI to describe the setting,</span>
<span class="sd">            e.g. &#39;sweep/settling/time&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Should this look up in _sweepdict rather than query the</span>
        <span class="c1"># instrument?</span>
        <span class="n">returndict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweeper</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>  <span class="c1"># this is a dict</span>

        <span class="c1"># The dict may have different &#39;depths&#39; depending on the parameter.</span>
        <span class="c1"># The depth is encoded in the setting string (number of &#39;/&#39;)</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">setting</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">while</span> <span class="n">keys</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">returndict</span> <span class="o">=</span> <span class="n">returndict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">rawvalue</span> <span class="o">=</span> <span class="n">returndict</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rawvalue</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rawvalue</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">rawvalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rawvalue</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rawvalue</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">rawvalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">rawvalue</span>

        <span class="k">return</span> <span class="n">value</span>

<div class="viewcode-block" id="ZIUHFLI.add_signal_to_sweeper"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.ZI.html#qcodes.instrument_drivers.ZI.ZIUHFLI.ZIUHFLI.add_signal_to_sweeper">[docs]</a>    <span class="k">def</span> <span class="nf">add_signal_to_sweeper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">demodulator</span><span class="p">,</span> <span class="n">attribute</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a signal to the output of the sweeper. When the sweeper sweeps,</span>
<span class="sd">        the signals added to the sweeper are returned.</span>

<span class="sd">        Args:</span>
<span class="sd">            demodulator (int): A number from 1-8 choosing the demodulator.</span>
<span class="sd">              The same demodulator can be chosen several times for</span>
<span class="sd">              different attributes, e.g. demod1 X, demod1 phase</span>
<span class="sd">            attribute (str): The attribute to record, e.g. phase or Y</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: if a demodulator outside the allowed range is</span>
<span class="sd">              selected</span>
<span class="sd">            ValueError: if an attribute not in the list of allowed attributes</span>
<span class="sd">              is selected</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># TODO: implement all possibly returned attributes</span>
        <span class="n">valid_attributes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;phase&#39;</span><span class="p">,</span> <span class="s1">&#39;Xrms&#39;</span><span class="p">,</span> <span class="s1">&#39;Yrms&#39;</span><span class="p">,</span> <span class="s1">&#39;Rrms&#39;</span><span class="p">]</span>

        <span class="c1"># Validation</span>
        <span class="k">if</span> <span class="n">demodulator</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can not select demodulator&#39;</span> <span class="o">+</span>
                             <span class="s1">&#39; </span><span class="si">{}</span><span class="s1">. Only &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">demodulator</span><span class="p">)</span> <span class="o">+</span>
                             <span class="s1">&#39;demodulators 1-8 are available.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_attributes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Can not select attribute:&#39;</span><span class="o">+</span>
                             <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">. Only the following attributes are&#39;</span> <span class="o">+</span>
                             <span class="s1">&#39; available: &#39;</span> <span class="o">+</span>
                             <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">, &#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">valid_attributes</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">valid_attributes</span><span class="p">))</span>

        <span class="c1"># internally, we use strings very similar to the ones used by the</span>
        <span class="c1"># instrument, but with the attribute added, e.g.</span>
        <span class="c1"># &#39;/dev2189/demods/0/sample/X&#39; means X of demodulator 1.</span>
        <span class="n">signalstring</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">+</span>
                        <span class="s1">&#39;/demods/</span><span class="si">{}</span><span class="s1">/sample/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">demodulator</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                      <span class="n">attribute</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">signalstring</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sweeper_signals</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sweeper_signals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">signalstring</span><span class="p">)</span></div>

<div class="viewcode-block" id="ZIUHFLI.remove_signal_from_sweeper"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.ZI.html#qcodes.instrument_drivers.ZI.ZIUHFLI.ZIUHFLI.remove_signal_from_sweeper">[docs]</a>    <span class="k">def</span> <span class="nf">remove_signal_from_sweeper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">demodulator</span><span class="p">,</span> <span class="n">attribute</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a signal from the output of the sweeper. If the signal</span>
<span class="sd">        has not previously been added, a warning is logged.</span>

<span class="sd">        Args:</span>
<span class="sd">            demodulator (int): A number from 1-8 choosing the demodulator.</span>
<span class="sd">              The same demodulator can be chosen several times for</span>
<span class="sd">              different attributes, e.g. demod1 X, demod1 phase</span>
<span class="sd">            attribute (str): The attribute to record, e.g. phase or Y</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">signalstring</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">+</span>
                        <span class="s1">&#39;/demods/</span><span class="si">{}</span><span class="s1">/sample/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">demodulator</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                      <span class="n">attribute</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">signalstring</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sweeper_signals</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Can not remove signal with </span><span class="si">{}</span><span class="s1"> of&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span> <span class="o">+</span>
                        <span class="s1">&#39; demodulator </span><span class="si">{}</span><span class="s1">, since it was&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">demodulator</span><span class="p">)</span> <span class="o">+</span>
                        <span class="s1">&#39; not previously added.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sweeper_signals</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">signalstring</span><span class="p">)</span></div>

<div class="viewcode-block" id="ZIUHFLI.print_sweeper_settings"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.ZI.html#qcodes.instrument_drivers.ZI.ZIUHFLI.ZIUHFLI.print_sweeper_settings">[docs]</a>    <span class="k">def</span> <span class="nf">print_sweeper_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pretty-print the current settings of the sweeper.</span>
<span class="sd">        If Sweep.build_sweep and Sweep.get are called, the sweep described</span>
<span class="sd">        here will be performed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ACQUISITION&#39;</span><span class="p">)</span>
        <span class="n">toprint</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sweeper_BWmode&#39;</span><span class="p">,</span> <span class="s1">&#39;sweeper_BW&#39;</span><span class="p">,</span> <span class="s1">&#39;sweeper_order&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;sweeper_averaging_samples&#39;</span><span class="p">,</span> <span class="s1">&#39;sweeper_averaging_time&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;sweeper_settlingtime&#39;</span><span class="p">,</span> <span class="s1">&#39;sweeper_settlingtc&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">paramname</span> <span class="ow">in</span> <span class="n">toprint</span><span class="p">:</span>
            <span class="n">parameter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">paramname</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    </span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parameter</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">parameter</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
                                           <span class="n">parameter</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;HORISONTAL&#39;</span><span class="p">)</span>
        <span class="n">toprint</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sweeper_start&#39;</span><span class="p">,</span> <span class="s1">&#39;sweeper_stop&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;sweeper_units&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;sweeper_samplecount&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;sweeper_param&#39;</span><span class="p">,</span> <span class="s1">&#39;sweeper_mode&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;sweeper_timeout&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">paramname</span> <span class="ow">in</span> <span class="n">toprint</span><span class="p">:</span>
            <span class="n">parameter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">paramname</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    </span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parameter</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">parameter</span><span class="o">.</span><span class="n">get</span><span class="p">()))</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;VERTICAL&#39;</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">signal</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sweeper_signals</span><span class="p">:</span>
            <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">dm</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    Signal </span><span class="si">{}</span><span class="s1">: Demodulator </span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">fmt</span><span class="p">))</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;timeconstant&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="s1">&#39;samplerate&#39;</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DEMODULATORS&#39;</span><span class="p">)</span>
        <span class="n">demods</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">signal</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sweeper_signals</span><span class="p">:</span>
            <span class="n">demods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="n">demods</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">demods</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dm</span> <span class="ow">in</span> <span class="n">demods</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
                <span class="n">parameter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;demod</span><span class="si">{:d}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">feat</span><span class="p">)]</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="p">(</span><span class="n">dm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">parameter</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">parameter</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">parameter</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    Demodulator </span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">: </span><span class="si">{:.6f}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">fmt</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;META&#39;</span><span class="p">)</span>
        <span class="n">swptime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweeper_sweeptime</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">swptime</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    Expected sweep time: </span><span class="si">{:.1f}</span><span class="s1"> (s)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">swptime</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    Expected sweep time: N/A in auto mode&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    Sweep timeout: </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweeper_timeout</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span>
                                                  <span class="s1">&#39;s&#39;</span><span class="p">))</span>
        <span class="n">ready</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_correctly_built</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    Sweep built and ready to execute: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ready</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_scope_setter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scopemodule</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">setting</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set_cmd for all scope parameters. The value and setting are saved in</span>
<span class="sd">        a dictionary which is read by the Scope parameter&#39;s build_scope method</span>
<span class="sd">        and only then sent to the instrument.</span>

<span class="sd">        Args:</span>
<span class="sd">            scopemodule (int): Indicates whether this is a setting of the</span>
<span class="sd">                scopeModule or not. 1: it is a scopeModule setting,</span>
<span class="sd">                0: it is not.</span>
<span class="sd">            mode (int): Indicates whether we are setting an int or a float.</span>
<span class="sd">                0: int, 1: float. NOTE: Ignored if scopemodule==1.</span>
<span class="sd">            setting (str): The setting, e.g. &#39;length&#39;.</span>
<span class="sd">            value (Union[int, float, str]): The value to set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Because setpoints need to be built</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scope_correctly_built</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Some parameters are linked to each other in specific ways</span>
        <span class="c1"># Therefore, we need special actions for setting these parameters</span>

        <span class="n">SRtranslation</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;kHz&#39;</span><span class="p">:</span> <span class="mf">1e3</span><span class="p">,</span> <span class="s1">&#39;MHz&#39;</span><span class="p">:</span> <span class="mf">1e6</span><span class="p">,</span> <span class="s1">&#39;GHz&#39;</span><span class="p">:</span> <span class="mf">1e9</span><span class="p">,</span>
                         <span class="s1">&#39;khz&#39;</span><span class="p">:</span> <span class="mf">1e3</span><span class="p">,</span> <span class="s1">&#39;Mhz&#39;</span><span class="p">:</span> <span class="mf">1e6</span><span class="p">,</span> <span class="s1">&#39;Ghz&#39;</span><span class="p">:</span> <span class="mf">1e9</span><span class="p">}</span>

        <span class="k">def</span> <span class="nf">setlength</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="c1"># TODO: add validation. The GUI seems to correect this value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">setDouble</span><span class="p">(</span><span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">/scopes/0/length&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span>
                               <span class="n">value</span><span class="p">)</span>
            <span class="n">SR_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;scope_samplingrate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span> <span class="o">=</span> <span class="n">SR_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">SR</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">number</span><span class="p">)</span><span class="o">*</span><span class="n">SRtranslation</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;scope_duration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_save_val</span><span class="p">(</span><span class="n">value</span><span class="o">/</span><span class="n">SR</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">setInt</span><span class="p">(</span><span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">/scopes/0/length&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">setduration</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="c1"># TODO: validation?</span>
            <span class="n">SR_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;scope_samplingrate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span> <span class="o">=</span> <span class="n">SR_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">SR</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">number</span><span class="p">)</span><span class="o">*</span><span class="n">SRtranslation</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
            <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">value</span><span class="o">*</span><span class="n">SR</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;scope_length&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_save_val</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;scope_duration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_save_val</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">setInt</span><span class="p">(</span><span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">/scopes/0/length&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">N</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">setholdoffseconds</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;scope_trig_holdoffmode&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">setDouble</span><span class="p">(</span><span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">/scopes/0/trigholdoff&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span>
                               <span class="n">value</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">setsamplingrate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="c1"># When the sample rate is changed, the number of points of the trace</span>
            <span class="c1"># remains unchanged and the duration changes accordingly</span>
            <span class="n">newSR_str</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_samplingrate_codes</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">_samplingrate_codes</span><span class="o">.</span><span class="n">keys</span><span class="p">()))[</span><span class="n">value</span><span class="p">]</span>
            <span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span> <span class="o">=</span> <span class="n">newSR_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">newSR</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">number</span><span class="p">)</span><span class="o">*</span><span class="n">SRtranslation</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
            <span class="n">oldSR_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;scope_samplingrate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span> <span class="o">=</span> <span class="n">oldSR_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">oldSR</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">number</span><span class="p">)</span><span class="o">*</span><span class="n">SRtranslation</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
            <span class="n">oldduration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;scope_duration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">newduration</span> <span class="o">=</span> <span class="n">oldduration</span><span class="o">*</span><span class="n">oldSR</span><span class="o">/</span><span class="n">newSR</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;scope_duration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_save_val</span><span class="p">(</span><span class="n">newduration</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">setInt</span><span class="p">(</span><span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">/scopes/0/time&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>

        <span class="n">specialcases</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;length&#39;</span><span class="p">:</span> <span class="n">setlength</span><span class="p">,</span>
                        <span class="s1">&#39;duration&#39;</span><span class="p">:</span> <span class="n">setduration</span><span class="p">,</span>
                        <span class="s1">&#39;scope_trig_holdoffseconds&#39;</span><span class="p">:</span> <span class="n">setholdoffseconds</span><span class="p">,</span>
                        <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">setsamplingrate</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">setting</span> <span class="ow">in</span> <span class="n">specialcases</span><span class="p">:</span>
            <span class="n">specialcases</span><span class="p">[</span><span class="n">setting</span><span class="p">](</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">sync</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># We have two different parameter types: those under</span>
            <span class="c1"># /scopes/0/ and those under scopeModule/</span>
            <span class="k">if</span> <span class="n">scopemodule</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;scopeModule/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">setting</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">setInt</span><span class="p">(</span><span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">/scopes/0/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
                                                         <span class="n">setting</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">setDouble</span><span class="p">(</span><span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">/scopes/0/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
                                                            <span class="n">setting</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_scope_getter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setting</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get_cmd for scopeModule parameters</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># There are a few special cases</span>
        <span class="n">SRtranslation</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;kHz&#39;</span><span class="p">:</span> <span class="mf">1e3</span><span class="p">,</span> <span class="s1">&#39;MHz&#39;</span><span class="p">:</span> <span class="mf">1e6</span><span class="p">,</span> <span class="s1">&#39;GHz&#39;</span><span class="p">:</span> <span class="mf">1e9</span><span class="p">,</span>
                         <span class="s1">&#39;khz&#39;</span><span class="p">:</span> <span class="mf">1e3</span><span class="p">,</span> <span class="s1">&#39;Mhz&#39;</span><span class="p">:</span> <span class="mf">1e6</span><span class="p">,</span> <span class="s1">&#39;Ghz&#39;</span><span class="p">:</span> <span class="mf">1e9</span><span class="p">}</span>

        <span class="k">def</span> <span class="nf">getduration</span><span class="p">():</span>
            <span class="n">SR_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;scope_samplingrate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span> <span class="o">=</span> <span class="n">SR_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">SR</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">number</span><span class="p">)</span><span class="o">*</span><span class="n">SRtranslation</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span>
            <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;scope_length&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">N</span><span class="o">/</span><span class="n">SR</span>
            <span class="k">return</span> <span class="n">duration</span>

        <span class="n">specialcases</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;duration&#39;</span><span class="p">:</span> <span class="n">getduration</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">setting</span> <span class="ow">in</span> <span class="n">specialcases</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">specialcases</span><span class="p">[</span><span class="n">setting</span><span class="p">]()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">querystr</span> <span class="o">=</span> <span class="s1">&#39;scopeModule/&#39;</span> <span class="o">+</span> <span class="n">setting</span>
            <span class="n">returndict</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">querystr</span><span class="p">)</span>
            <span class="c1"># The dict may have different &#39;depths&#39; depending on the parameter.</span>
            <span class="c1"># The depth is encoded in the setting string (number of &#39;/&#39;)</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">setting</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

            <span class="k">while</span> <span class="n">keys</span> <span class="o">!=</span> <span class="p">[]:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">returndict</span> <span class="o">=</span> <span class="n">returndict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">rawvalue</span> <span class="o">=</span> <span class="n">returndict</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rawvalue</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rawvalue</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">rawvalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rawvalue</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rawvalue</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">rawvalue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">rawvalue</span>

        <span class="k">return</span> <span class="n">value</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_to_float</span><span class="p">(</span><span class="n">frequency</span><span class="p">):</span>
        <span class="n">converter</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;hz&#39;</span><span class="p">:</span> <span class="s1">&#39;e0&#39;</span><span class="p">,</span> <span class="s1">&#39;khz&#39;</span><span class="p">:</span> <span class="s1">&#39;e3&#39;</span><span class="p">,</span> <span class="s1">&#39;mhz&#39;</span><span class="p">:</span> <span class="s1">&#39;e6&#39;</span><span class="p">,</span> <span class="s1">&#39;ghz&#39;</span><span class="p">:</span> <span class="s1">&#39;e9&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;thz&#39;</span><span class="p">:</span> <span class="s1">&#39;e12&#39;</span><span class="p">}</span>
        <span class="n">value</span><span class="p">,</span> <span class="n">suffix</span> <span class="o">=</span> <span class="n">frequency</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">value</span><span class="p">,</span> <span class="n">converter</span><span class="p">[</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()]]))</span>

<div class="viewcode-block" id="ZIUHFLI.round_to_nearest_sampling_frequency"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.ZI.html#qcodes.instrument_drivers.ZI.ZIUHFLI.ZIUHFLI.round_to_nearest_sampling_frequency">[docs]</a>    <span class="k">def</span> <span class="nf">round_to_nearest_sampling_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desired_sampling_rate</span><span class="p">):</span>
        <span class="n">available_frequencies</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.8e9</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">_samplingrate_codes</span><span class="p">[</span><span class="n">freq</span><span class="p">]</span>
                                 <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_samplingrate_codes</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>

        <span class="n">nearest_frequency</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">available_frequencies</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span>
            <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">desired_sampling_rate</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">nearest_frequency</span></div>

    <span class="k">def</span> <span class="nf">_set_samplingrate_as_float</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency</span><span class="p">):</span>
        <span class="n">float_samplingrate_map</span> <span class="o">=</span> <span class="p">{</span><span class="mf">1.8e9</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">v</span><span class="p">:</span> <span class="n">k</span>
                                  <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_samplingrate_codes</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">frequency_as_string</span> <span class="o">=</span> <span class="n">float_samplingrate_map</span><span class="p">[</span><span class="n">frequency</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scope_samplingrate</span><span class="p">(</span><span class="n">frequency_as_string</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_samplingrate_as_float</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">frequency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope_samplingrate</span><span class="p">()</span>
        <span class="n">correct_frequency</span> <span class="o">=</span> <span class="mf">1.8e9</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">_samplingrate_codes</span><span class="p">[</span><span class="n">frequency</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">correct_frequency</span>

<div class="viewcode-block" id="ZIUHFLI.close"><a class="viewcode-back" href="../../../../api/generated/qcodes.instrument_drivers.ZI.html#qcodes.instrument_drivers.ZI.ZIUHFLI.ZIUHFLI.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Override of the base class&#39; close function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">(</span><span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">/scopes/0/wave&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweeper</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daq</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>